<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reserva tu Cita</title>
  <link rel="stylesheet" href="reserva.css" />
</head>
<body>
  <section class="steps2-wrapper" style="padding: 40px 20px; max-width: 600px; margin: auto;">
        <h2 class="thq-heading-2" style="text-align: center;">üìÖ Reserv√° tu Cita</h2>
    <p style="text-align: center; margin-bottom: 24px;">
      Agend√° una sesi√≥n personalizada y conoc√© c√≥mo mejorar tu presencia digital y comunicaci√≥n impresa.
    </p>
    <p style="text-align: center; margin-bottom: 24px;">
      Reserv√° de lunes a viernes a las 19h o s√°bados de 9h a 12h.
    </p>

    <form id="formTurno">
      <label>Fecha</label>
      <input type="date" id="fechaTurno" name="fechaTurno" required><br>

      <label>Hora</label>
      <input type="time" id="horaTurno" name="horaTurno"><br>
      <select id="horaSelect" name="horaSelect" style="display:none;"></select><br>

      <label>* Nombre</label>
      <input type="text" name="nombre" required><br>

      <label>* Apellido</label>
      <input type="text" name="apellido" required><br>

      <label>* Email</label>
      <input type="email" name="email" required><br>

      <label>* Tel√©fono</label>
      <input type="tel" name="telefono" required><br>

      <label>Tipo de negocio</label>
      <input type="text" name="tipoNegocio"><br>

      <label>Nombre del negocio</label>
      <input type="text" name="nombreNegocio"><br>

      <label>¬øC√≥mo nos conociste?</label>
      <input type="text" name="conocio"><br>

      <label>Comentario adicional</label>
      <textarea name="comentario"></textarea><br>

      <button type="submit" style="margin-top: 20px;">Confirmar cita</button>
    </form>

    <div style="text-align: center; margin-top: 30px;">
      <a href="index.html">‚Üê Volver al inicio</a>
    </div>
  </section>

  <script>
      const fechaInput = document.getElementById('fechaTurno');
      const horaInput = document.getElementById('horaTurno');
      const horaSelect = document.getElementById('horaSelect');
      document.addEventListener('DOMContentLoaded', () => {

          // Setear fecha m√≠nima y m√°xima
          const hoy = new Date();
          const maxDate = new Date();
          maxDate.setDate(hoy.getDate() + 30);

          const formatoFecha = (fecha) => fecha.toISOString().split('T')[0];
          fechaInput.min = formatoFecha(hoy);
          fechaInput.max = formatoFecha(maxDate);

          // Opciones s√°bado
          const opcionesSabado = [
              '09:00', '09:30', '10:00', '10:30', '11:00', '11:30', '12:00'
          ];    
          // Al cambiar la fecha, ajustar el comportamiento del campo hora
          fechaInput.addEventListener('change', () => {
          const seleccionada = new Date(fechaInput.value);
          const dia = seleccionada.getDay(); // 0Lun, 1Mar, 2Mie, 3Jue, 4Vie, 5sab, 6dom

          // Resetear ambos campos
          horaInput.value = '';
          horaSelect.innerHTML = '';
          horaInput.style.display = 'none';
          horaSelect.style.display = 'none';

          if (dia === 6) {
          // Domingo
          alert('Los domingos no est√°n disponibles. Por favor eleg√≠ otro d√≠a.');
          fechaInput.value = '';
          return;
          } else if (dia === 5) {
          // S√°bado
          horaInput.style.display = 'none';
          horaSelect.style.display = 'block';
          horaSelect.innerHTML = ''; // Limpio antes de poblar

          opcionesSabado.forEach(hora => {
              const option = document.createElement('option');
              option.value = hora;
              option.textContent = hora;
              horaSelect.appendChild(option);
          });
          } else {
          // Lunes a viernes
          horaSelect.style.display = 'none';
          horaInput.style.display = 'block';
          horaInput.value = '19:00';
          }
          });

          // Configuraci√≥n inicial
          horaInput.value = '';
          horaInput.disabled = true;
      });

      // Manejador de env√≠o
      document.getElementById('formTurno').addEventListener('submit', function (e) {
        e.preventDefault();
        
        const form = document.getElementById('formTurno');
        const data = new FormData(form); 
        const formDataObj = {
          fechaTurno: data.get("fechaTurno"),
          horaTurno: data.get("horaTurno") || data.get("horaSelect"),
          nombreCompleto: data.get("nombre") + " " + (data.get("apellido") || ""),
          email: data.get("email"),
          telefono: data.get("telefono"),
          tipoNegocio: data.get("tipoNegocio"),
          nombreNegocio: data.get("nombreNegocio"),
          medio: data.get("conocio"),
          comentario: data.get("comentario"),
          plan: "agenda",
          pago: "false",
          redirect: "https://menulab.com.ar/reserva-ok.html"
        };

        console.log("üì¶ Payload final:", new URLSearchParams(formDataObj).toString());

        // Enviar datos a Apps Script usando form-urlencoded
        const url = "https://script.google.com/macros/s/AKfycbz7ATic7Huuqk_O0hcUmeJfoYhW5v8JCzMht0dv1bd8426mTunUbyWpr5Yxr9AvnHiG/exec"
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          body: new URLSearchParams(formDataObj).toString()
        })
        .then(() => {
          console.log("‚úÖ Datos enviados a Apps Script (no-cors, sin respuesta)");
          if (formDataObj.redirect) {
            window.location.href = formDataObj.redirect;
          } else {
            alert("Formulario enviado pero sin redirecci√≥n.");
          }
        })
        .catch(err => {
          console.error("‚ùå Error al enviar a Apps Script:", err);
          alert("Ocurri√≥ un error al enviar tus datos. Intent√° nuevamente.");
        });
      });
  </script>
</body>
</html>