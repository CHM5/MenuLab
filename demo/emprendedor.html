<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Demo - MenuLab</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" 
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" 
      crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      --nombre-restaurante: "Caf√© Central";
      --subtitulo-restaurante: "Todo rico, todo el d√≠a";
      --direccion-restaurante: "Av. Corrientes 123";
      --horario-restaurante: "Martes a Domingos de 8 a 20hs";
      --telefono-restaurante: "+54 11 1234-5678";
      --color-nombre-resto: #000;
      --color-nombre-slogan: #000;
      --color-categoria: #000;
      --color-subcategoria: #000;
      --color-plato: #000;
      --color-descripcion: #555;
      --color-precio: #000;
      --color-info-resto: #000;
      --color-bg: #fff;
      --bg-opacity: 0.2;

      --logo-size: 100px;
      --size-nombre-resto: 2rem;
      --size-nombre-slogan: 1rem;
      --size-categoria: 1.5rem;
      --size-subcategoria: 1rem;
      --size-plato: 0.95rem;
      --size-descripcion: 0.8rem;
      --size-precio: 0.9rem;
      --size-info-resto: 0.8rem;

      --tracking: 0px;
      
      --menu-columns: 2;
    }
    @page {
      @top-left { content: none; }
      @top-center { content: none; }
      @top-right { content: none; }
      @bottom-left { content: none; }
      @bottom-center { content: none; }
      @bottom-right { content: none; }
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0 auto;
      padding-top: 70px; 
      column-count: var(--menu-columns);           
      column-gap: 20px;
      position: relative;
      background: var(--color-bg);

      -webkit-column-rule: 1px solid rgba(0,0,0,0.06);
      -moz-column-rule: 1px solid rgba(0,0,0,0.06);
      column-rule: 1px solid rgba(0,0,0,0.06);
      column-rule-gap: 20px;
      letter-spacing: var(--tracking);
    }

    #menuTable,
    .resto-header, .footer {
      font-size: var(--size-plato);
    }

    @media screen and (max-width: 991px) {
      body {
        margin-left: 10px;
        margin-right: 10px;
        column-count: var(--menu-columns);
        column-gap: 15px;
      }
    }

    @media screen and (min-width: 992px) {
      body {
        margin-left: 300px;
        margin-right: 300px;
        column-count: var(--menu-columns);
      }
    }

    h2 { 
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px; /* espacio entre firuletes y texto */
      font-size: var(--size-categoria);
      color: var(--color-categoria);
      font-weight: bold;
      text-align: center;
      margin: 1.2rem 0 0.8rem;
    }
    h2::before,
    h2::after {
      content: var(--firulete, "‚ú¶ ‚ú¶ ‚ú¶");
      color: var(--color-categoria, #b28051);
      font-size: 1rem;
      opacity: 0.4;
      white-space: nowrap;
      flex-shrink: 0; /* evita que se encojan */
    }

    h2::before {
      left: calc(50% - 10rem); /* distancia desde el centro hacia la izquierda */
    }

    h2::after {
      right: calc(50% - 10rem); /* distancia desde el centro hacia la derecha */
    }

    h3 {
      font-size: var(--size-subcategoria);
      font-style: italic;
      text-align: left;
      break-after: avoid;
      page-break-after: avoid;
      color: var(--color-subcategoria);
      border-bottom: 1px solid #eee;
    }

    h4 {
      font-size: var(--size-plato);
      margin: 0.2rem 0; 
    }

    .menu-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 0.4rem 0;
      break-inside: avoid-column;
      page-break-inside: avoid;
    }

    /* === ICONOS DIETARIOS === */
    .icon-diet {
      width: 18px;
      height: 18px;
      object-fit: contain;
      vertical-align: middle;
      margin-right: -7px;
      filter: drop-shadow(0 0 1px rgba(0,0,0,0.2));
    }

    .diet-icons.inline {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-right: 6px;
      margin-top: 0;
    }

    .diet-icons.inline span {
      line-height: 1;
      transform: translateY(2px);
    }

    .menu-item.destacado {
      background: rgba(0, 0, 0, 0.05);
      border-left: 4px solid rgba(0, 0, 0, 0.3);
      border-radius: 6px;
      padding: 0.4rem 0.6rem;
    }

    .menu-plate {
      flex: 1;
      color: var(--color-plato);
      display: flex;
      flex-direction: column;
    }

    .menu-plate h4 {
      margin: 0;
      font-size: var(--size-plato);
      font-weight: bold;
      color: var(--color-plato);
    }

    .menu-description {
      margin: 0.15rem 0 0;
      font-size: var(--size-descripcion);
      color: var(--color-descripcion);
    }

    .menu-price {
      font-weight: bold;
      font-size: var(--size-precio);
      color: var(--color-precio);
      margin-left: 12px;
      white-space: nowrap;
      align-self: flex-start;
    }

    .dropbtn,
    #printBtn {
      background-color: #67b0dd;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s ease;
    }

    .dropbtn:hover,
    #printBtn:hover {
      background-color: #1D3557;
    }

    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      background: var(--color-bg);
      text-align: center;
      font-size: var(--size-info-resto);
      color: #444;
      border-top: 1px solid #ddd;
      padding: 8px 0;
      z-index: 1000;
      column-span: all;            
      -webkit-column-span: all;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
      backdrop-filter: blur(6px);
    }

    .footer span {
      margin: 0rem 8px;
      white-space: nowrap;
    }

    .resto-header {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      break-inside: avoid;
    }

    .resto-header img {
      width: var(--logo-size);
      height: var(--logo-size);
      border-radius: 50%;
      object-fit: cover;
    }

    .resto-text {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      color: #804000;
    }

    .resto-header h1 { margin: -5px; font-size: var(--size-nombre-resto); }

    .resto-header h3 {
      margin: 0 0 0;
      font-size: var(--size-nombre-slogan);
      font-weight: normal;
      font-style: italic;
      color: #b28051;
    }

    #nombre-resto {
      margin-bottom: -5px;
      color: var(--color-nombre-resto);
    }

    #subtitulo-resto{
      color: var(--color-nombre-slogan);
    }

    #direccion-resto,
    #horario-resto,
    #telefono-resto {
      color: var(--color-info-resto);
    }

    #topMenu {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #fff;
      padding: 10px 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      display: flex;
      justify-content: center; 
      align-items: center;
      flex-wrap: wrap; 
      gap: 10px;
    }

    #topMenu select {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.9rem;
      cursor: pointer;
    }

    #topMenu label {
      font-size: 0.9rem;
      color: #333;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    #topMenu input[type="color"] {
      width: 40px;
      height: 40px;
      border: none;
      padding: 0;
      cursor: pointer;
      border-radius: 4px;
      -webkit-appearance: none;
      appearance: none;
    }

    #topMenu input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 4px;
    }

    #topMenu input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 4px;
    }

    #topMenu input[type="color"]:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(69, 123, 157, 0.5);
    }

    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropbtn {
      background-color: #67b0dd;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      z-index: 1;
      border-radius: 6px;
      padding: 10px;
    }

    .dropdown-content label {
      display: block;
      margin: 8px 0;
      font-size: 0.9rem;
      color: #333;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    .print-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url("https://res.cloudinary.com/drxznqm61/image/upload/v1759872998/drilldown-removebg-preview_zczol3.png")
                  no-repeat center center;
      background-size: var(--bg-size-scale, 100%);
      opacity: var(--bg-opacity);
      z-index: 0;
      pointer-events: none;
    }

    @media (max-width: 768px) {
    #topMenu {
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
      padding: 10px;
      gap: 6px;
    }

    .dropdown,
    #printBtn {
      flex: 1 1 30%; 
      text-align: center;
    }

    .dropbtn,
    #printBtn {
      width: 100%;
      padding: 8px 0;
      font-size: 0.85rem;
    }

    label {
      font-size: 0.8rem;
    }

    input[type="range"] {
      width: 100%;
    }
  }

  #colorMenu label{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:6px;
  }

  #colorMenu .color-group{
    width:18px;
    height:18px;
    accent-color:#457B9D;
  }

  #colorMenu:not(.active) .color-group{
    display:none;
  }

  #colorMenu.active .color-group{
    display:inline-block;
    cursor:pointer;
  }

  #colorMenu.active label:hover{
    background:#eef6fa;
    border-radius:4px;
  }

  #masterColorContainer {
    display: none;
    justify-content: space-between;
    align-items: center;
  }

  #colorMenu.active #masterColorContainer {
    display: flex;
  }

  #masterColor {
    width: 32px;
    height: 32px;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    transition: transform 0.2s ease;
  }

  #masterColor:hover {
    transform: scale(1.05);
  }

  #presetSelector {
    width: 100%;
    border-radius: 6px;
    border: 1px solid #ccc;
    padding: 6px;
    font-size: 0.9rem;
    cursor: pointer;
  }

  #sizeMenu label{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:6px;
  }

  #sizeMenu .size-group{
    width:14px;
    height:14px;
    accent-color:#457B9D;
  }

  #sizeMenu:not(.active) .size-group{
    display:none;
  }

  #sizeMenu.active .size-group{
    display:inline-block;
    cursor:pointer;
  }

  #sizeMenu.active label:hover{
    background:#eef6fa;
    border-radius:4px;
  }

  /* === CAR√ÅTULA === */
  .cover-page {
    position: relative;
    width: 100%;
    height: 120vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: var(--color-nombre-resto);
    background: var(--color-bg);
    column-span: all;
    z-index: 1 !important;
  }

  .footer {
    display: block !important;
  }
  .menu-item, .resto-header {
    break-inside: avoid;
    page-break-inside: avoid;
  }

  .cover-page img {
    width: calc(180px * var(--cover-font-size));
    height: calc(180px * var(--cover-font-size));
    border-radius: 25%;
    object-fit: cover;
    margin-bottom: 1.5rem;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    z-index: 1;
  }

  .cover-page h1 {
    font-size: calc(2.2rem * var(--cover-font-size));
    margin: 0.5rem 0;
    color: var(--color-nombre-resto);
    background: var(--color-bg); 
    backdrop-filter: blur(4px);
    padding: 0.05rem 0.35rem;
    border-radius: 4px;
    display: inline-block;
    line-height: 1;
    box-decoration-break: clone; 
    -webkit-box-decoration-break: clone;
  }

  .cover-page h3 {
    font-size: calc(1.2rem * var(--cover-font-size));
    font-style: italic;
    color: var(--color-nombre-slogan);
    margin-bottom: 10.5rem;
    background: var(--color-bg); 
    backdrop-filter: blur(4px);
    padding: 0.05rem 0.35rem;
    border-radius: 4px;
    display: inline-block;
    line-height: 1;
    box-decoration-break: clone; 
    -webkit-box-decoration-break: clone;
  }

  .cover-page p {
    font-size: calc(1rem * var(--cover-font-size));
    color: var(--color-info-resto);
    margin: 0.5rem 0;
    background: var(--color-bg); 
    backdrop-filter: blur(4px);
    padding: 0.05rem 0.35rem;
    border-radius: 4px;
    display: inline-block;
    line-height: 1;
    box-decoration-break: clone; 
    -webkit-box-decoration-break: clone;
  }

  .page-break {
    page-break-after: always;
  }
  
  html, body {
    background: var(--color-bg);
  }  

  @media print {
    @page {
      size: A4;
      margin: 10mm 5mm 10mm 10mm;
    }
    
    /* === CONFIGURACI√ìN GENERAL === */
    body {
      background: var(--color-bg) !important;
      column-count: var(--menu-columns) !important;
      column-gap: 15px !important;
      width: 210mm !important;
      max-width: 210mm !important;
      margin: 0 !important;
      padding: 0 !important;
    }

      html, body {
        background: var(--color-bg) !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        z-index: -500;
      }

    #topMenu, #printBtn, #fontSelector, select#fontSelector {
      display: none !important;
    }

    /* === BACKGROUND: que se imprima en TODAS las p√°ginas === */
    .print-background {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("https://res.cloudinary.com/drxznqm61/image/upload/v1759872998/drilldown-removebg-preview_zczol3.png") no-repeat center center;
      background-size: var(--bg-size-scale, 100%);
      opacity: var(--bg-opacity);
      z-index: -1;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    /* === FOOTER === */
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 0.75rem;
      border-top: 1px solid #ddd;
      background: var(--color-bg);
      color: #444;
      padding: 6px 0;
    }

    /* === CAR√ÅTULA === */
    .cover-page {
      position: relative;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1 !important;
      background: transparent !important;
    }

    /* ‚úÖ Ocultar footer SOLO en la primera hoja */
    .resto-header ~ .footer {
      display: block !important;
    }
    .footer {
      display: none !important;
    }

    /* Evitar cortes raros */
    .menu-item, .resto-header {
      break-inside: avoid;
      page-break-inside: avoid;
    }
  }

  #firuleteSelector label {
    display: block;
    padding: 6px 10px;
    cursor: pointer;
    font-size: 0.9rem;
    border-radius: 4px;
    transition: background 0.2s ease;
  }

  #firuleteSelector label:hover {
    background-color: #eef6fa;
  }

  #fontSelectorMenu label {
    display: block;
    padding: 6px 10px;
    cursor: pointer;
    font-size: 0.9rem;
    border-radius: 4px;
    transition: background 0.2s ease;
  }

  #fontSelectorMenu label:hover {
    background-color: #eef6fa;
  }

  #presetSelectorMenu label {
    display: block;
    padding: 8px 10px;
    cursor: pointer;
    font-size: 0.95rem;
    border-radius: 4px;
    transition: background 0.2s ease;
  }

  #presetSelectorMenu label:hover {
    background-color: #eef6fa;
  }

  .tama√±os {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
  }
  </style>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto+Slab:wght@400;700&family=Pacifico&family=Lato:wght@400;700&family=Merriweather:wght@400;700&family=Montserrat:wght@400;700&family=Indie+Flower&family=Playfair+Display:wght@400;700&family=Source+Code+Pro:wght@400;700&family=Unbounded:wght@400;700&family=Syne:wght@400;700&family=Sora:wght@400;700&family=Staatliches&family=Caveat&family=Yeseva+One&family=Righteous&family=Cormorant+Garamond:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="print-background"></div>
    <div id="topMenu">
      <div class="dropdown">
        <button class="dropbtn">üåà Estilos</button>
        <div class="dropdown-content" id="presetSelectorMenu" style="min-width:220px;">
          <label data-value="1">‚òï Vintage</label>
          <label data-value="2">üåø Natural Pastel</label>
          <label data-value="3">üñ§ Minimalista Oscuro</label>
          <label data-value="4">üíé Luxury Dorado</label>
          <label data-value="5">üìú Cl√°sico Italiano</label>
          <label data-value="6">ü©µ Celeste Moderno</label>
          <label data-value="7">üçÇ Oto√±al Suave</label>
          <label data-value="8">‚ö° Tech Futurista</label>
          <label data-value="9">üé® Pop Alegre</label>
          <label data-value="10">ü§ç Blanco Neutro</label>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">üñãÔ∏è Fuente</button>
        <div class="dropdown-content" id="fontSelectorMenu" style="min-width:260px;overflow-y: visible;max-height: none;">
          <label data-value="arial" style="font-family: Arial, sans-serif;">Arial</label>
          <label data-value="oswald" style="font-family: 'Oswald', Arial, sans-serif;">Condensed Grotesk</label>
          <label data-value="roboto-slab" style="font-family: 'Roboto Slab', serif;">Serif Moderna</label>
          <label data-value="pacifico" style="font-family: 'Pacifico', cursive;">Manuscrita Cursiva</label>
          <label data-value="lato" style="font-family: 'Lato', Arial, sans-serif;">Sans Elegante</label>
          <label data-value="merriweather" style="font-family: 'Merriweather', serif;">Serif Cl√°sica</label>
          <label data-value="montserrat" style="font-family: 'Montserrat', Arial, sans-serif;">Sans Moderna</label>
          <label data-value="indie-flower" style="font-family: 'Indie Flower', cursive;">Manuscrita Casual</label>
          <label data-value="playfair" style="font-family: 'Playfair Display', serif;">Serif Fashion</label>
          <label data-value="source-code" style="font-family: 'Source Code Pro', monospace;">Monoespaciada</label>
          <label data-value="unbounded" style="font-family: 'Unbounded', sans-serif;">Futurista Geom√©trica</label>
          <label data-value="syne" style="font-family: 'Syne', sans-serif;">Experimental Bold</label>
          <label data-value="sora" style="font-family: 'Sora', sans-serif;">Tech Elegante</label>
          <label data-value="staatliches" style="font-family: 'Staatliches', sans-serif;">Bauhaus Brutalista</label>
          <label data-value="caveat" style="font-family: 'Caveat', cursive;">Manuscrita Clara</label>
          <label data-value="yeseva-one" style="font-family: 'Yeseva One', serif;">Serif Chic</label>
          <label data-value="righteous" style="font-family: 'Righteous', cursive;">Redondeada Moderna</label>
          <label data-value="cormorant-garamond" style="font-family: 'Cormorant Garamond', serif;">Gourmet Serif</label>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">üî§ Tama√±os</button>
        <div class="dropdown-content" id="sizeMenu" style="min-width:220px;">
          
          <label class="tama√±os">
            <span>Logo</span>
            <input type="checkbox" class="size-group">
            <input type="number" id="logo-size-number" step="1" style="width:64px;">
          </label>
          <input type="range" id="logo-size-range" min="50" max="220" step="1">

          <label class="tama√±os">
            <span>Nombre</span>
            <input type="checkbox" class="size-group">
            <input type="number" id="size-nombre-resto-number" step="0.01" style="width:64px;">
          </label>
          <input type="range" id="size-nombre-resto-range" min="1" max="4" step="0.01">

          <label class="tama√±os">
            <span>Slogan</span>
            <input type="checkbox" class="size-group">
            <input type="number" id="size-nombre-slogan-number" step="0.01" style="width:64px;">
          </label>
          <input type="range" id="size-nombre-slogan-range" min="0.6" max="2" step="0.01">

          <label class="tama√±os">
            <span>Categor√≠a</span>
            <input type="checkbox" class="size-group">
            <input type="number" id="size-categoria-number" step="0.01" style="width:64px;">
          </label>
          <input type="range" id="size-categoria-range" min="0.8" max="4" step="0.01">

          <label class="tama√±os">
            <span>Subcat.</span>
            <input type="checkbox" class="size-group">
            <input type="number" id="size-subcategoria-number" step="0.01" style="width:64px;">
          </label>
          <input type="range" id="size-subcategoria-range" min="0.6" max="2" step="0.01">

          <label class="tama√±os">
            <span>Plato</span>
            <input type="checkbox" class="size-group">
            <input type="number" id="size-plato-number" step="0.01" style="width:64px;">
          </label>
          <input type="range" id="size-plato-range" min="0.5" max="2" step="0.01">

          <label class="tama√±os">
            <span>Descripci√≥n</span>
            <input type="checkbox" class="size-group">
            <input type="number" id="size-descripcion-number" step="0.01" style="width:64px;">
          </label>
          <input type="range" id="size-descripcion-range" min="0.4" max="1.5" step="0.01">

          <label class="tama√±os">
            <span>Precio</span>
            <input type="checkbox" class="size-group">
            <input type="number" id="size-precio-number" step="0.01" style="width:64px;">
          </label>
          <input type="range" id="size-precio-range" min="0.5" max="2" step="0.01">

          <label class="tama√±os">
            <span>Info</span>
            <input type="checkbox" class="size-group">
            <input type="number" id="size-info-resto-number" step="0.01" style="width:64px;">
          </label>
          <input type="range" id="size-info-resto-range" min="0.4" max="1.5" step="0.01">

          <hr style="margin:8px 0;">
          <label style="display:flex;align-items:center;gap:6px;font-size:0.85rem;">
            <input type="checkbox" id="sameSizeMode">
            Aplicar mismo tama√±o a los seleccionados
          </label>

          <div id="masterSizeContainer" style="display:none;align-items:center;gap:6px;margin-top:6px;">
            <label style="font-size:0.85rem;">Tama√±o principal</label>
            <input type="range" id="masterSizeRange" min="0.5" max="4" step="0.01" value="1" style="flex:1;">
          </div>

          <small style="display:block;color:#555;font-size:0.75rem;margin-top:4px;">
            (Marc√° varios campos y eleg√≠ variar el tama√±o a la vez)
          </small>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">üé® Colores</button>
        <div class="dropdown-content" id="colorMenu">
          <label>Nombre <input type="checkbox" class="color-group"> <input type="color" id="color-nombre-resto"></label>
          <label>Slogan <input type="checkbox" class="color-group"> <input type="color" id="color-nombre-slogan"></label>
          <label>Categoria <input type="checkbox" class="color-group"> <input type="color" id="color-categoria"></label>
          <label>Subcategoria <input type="checkbox" class="color-group"> <input type="color" id="color-subcategoria"></label>
          <label>Plato <input type="checkbox" class="color-group"> <input type="color" id="color-plato"></label>
          <label>Descripci√≥n <input type="checkbox" class="color-group"> <input type="color" id="color-descripcion"></label>
          <label>Precio <input type="checkbox" class="color-group"> <input type="color" id="color-precio"></label>
          <label>Info <input type="checkbox" class="color-group"> <input type="color" id="color-info-resto"></label>

          <hr style="margin:8px 0;">
          <label style="display:flex;align-items:center;gap:6px;font-size:0.85rem;">
            <input type="checkbox" id="sameColorMode">
            Aplicar mismo color a los seleccionados
          </label>
          <!-- Cuadradito principal de color -->
          <div id="masterColorContainer" style="display:none;align-items:center;gap:6px;margin-top:6px;">
            <label style="font-size:0.85rem;">Color principal</label>
            <input type="color" id="masterColor" value="#000000" style="width:40px;height:40px;cursor:pointer;border:none;border-radius:4px;">
          </div>
          <small style="display:block;color:#555;font-size:0.75rem;margin-top:4px;">
            (Marc√° varios campos y eleg√≠ un color para aplicarlo a todos)
          </small>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">‚¨õ Columnas</button>
        <div class="dropdown-content" id="columnsMenu" style="min-width:160px;">
          <label data-value="1" class="columns-option" style="display:block;padding:8px 6px;cursor:pointer;">1 columna</label>
          <label data-value="2" class="columns-option" style="display:block;padding:8px 6px;cursor:pointer;">2 columnas</label>
          <label data-value="3" class="columns-option" style="display:block;padding:8px 6px;cursor:pointer;">3 columnas</label>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">‚ú® Firulete</button>
        <div class="dropdown-content" id="firuleteSelector">
          <label data-value="">Ninguno</label>
          <label data-value="‚ú¶ ‚ú¶ ‚ú¶">Brillos ‚ú¶ ‚ú¶ ‚ú¶</label>
          <label data-value="‚öú ‚öú ‚öú">Cl√°sico ‚öú ‚öú ‚öú</label>
          <label data-value="‚ö° ‚ö° ‚ö°">Rayo ‚ö° ‚ö° ‚ö°</label>
          <label data-value="‚ùß ‚ùß ‚ùß">Floral ‚ùß ‚ùß ‚ùß</label>
          <label data-value="‚òï ‚ô° ‚òï">Caf√© ‚òï ‚ô° ‚òï</label>
          <label data-value="üçÉ ‚úø üçÉ">Natural üçÉ ‚úø üçÉ</label>
          <label data-value="‚ú§ ‚ú§ ‚ú§">Sello ‚ú§ ‚ú§ ‚ú§</label>
          <label data-value="‚ãÑ ‚ãÑ ‚ãÑ">Rombo ‚ãÑ ‚ãÑ ‚ãÑ</label>
          <label data-value="‚ú® üí´ ‚ú®">M√°gico ‚ú® üí´ ‚ú®</label>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">üñºÔ∏è Fondo</button>
        <div class="dropdown-content" style="min-width:200px;">
          <label class="tama√±os">
            <span>Opacidad fondo</span>
            <input type="number" id="bg-opacity-number" step="0.01" style="width:64px;">
          </label>
          <input type="range" id="bg-opacity" min="0" max="0.5" step="0.01" value="0.2" style="width:100%;">

          <label class="tama√±os">
            <span>Tama√±o fondo</span>
            <input type="number" id="bg-size-number" step="1" style="width:64px;">
          </label>
          <input type="range" id="bg-size" min="50" max="200" step="1" value="100" style="width:100%;">
          <small style="display:block;color:#555;font-size:0.75rem;margin-top:4px;">
            (100% = tama√±o original del fondo)
          </small>
        </div>
      </div>
      <button id="printBtn" onclick="window.print()">üñ®Ô∏è Vista Previa</button>
    </div>

    <div class="resto-header">
      <img src="https://res.cloudinary.com/drxznqm61/image/upload/v1758652390/The_Pent_2_a8vhtp.jpg" alt="Logo Caf√© Central">
      <div class="resto-text">        
        <h1 id="nombre-resto"></h1>
        <h3 id="subtitulo-resto"></h3>
      </div>
    </div>
    <div id="menuTable"></div>
    <div class="footer">
      <span class="style-direccion"><i class="fa-solid fa-map-marker-alt"></i> <span id="direccion-resto"></span></span> &nbsp; | &nbsp;
      <span class="style-horarios"><i class="fa-solid fa-clock"></i> <span id="horario-resto"></span></span> &nbsp; | &nbsp;
      <span class="style-telefono"><i class="fa-solid fa-phone"></i> <span id="telefono-resto"></span></span>
    </div>

  <script>
  const allRows = [
    ["Cafeter√≠a", "Cl√°sicos", "Caf√© en Jarrito", "Caf√© espresso", "$1200"],
    ["Cafeter√≠a", "Cl√°sicos", "Caf√© con Leche", "Caf√© espresso con leche caliente.", "$1300"],
    ["Cafeter√≠a", "Cl√°sicos", "Caf√© Americano", "Caf√© filtrado suave, taza grande.", "$1100", "destacado"],
    ["Cafeter√≠a", "Especiales", "Flat White", "Espresso doble con leche microespumada.", "$1500"],
    ["Cafeter√≠a", "Especiales", "Latte Vainilla", "Caf√© con leche y sirope de vainilla.", "$1600"],
    ["Cafeter√≠a", "Especiales", "Cappuccino", "Espresso, leche y espuma, decorado con cacao.", "$1400"],
    ["Cafeter√≠a", "Fr√≠os", "Cold Brew", "Caf√© infusionado en fr√≠o por 12 horas.", "$1700"],
    ["Cafeter√≠a", "Fr√≠os", "Iced Latte", "Caf√© espresso, leche y hielo.", "$1600", "celiaco"],
    
    ["Pasteler√≠a", "Tortas", "Cheesecake", "Porci√≥n de cheesecake casero.", "$2200"],
    ["Pasteler√≠a", "Tortas", "Brownie", "Brownie de chocolate con nuez y bocha de helado de lim√≥n.", "$1800"],
    ["Pasteler√≠a", "Tortas", "Carrot Cake", "Bizcocho h√∫medo de zanahoria y especias.", "$2100"],
    ["Pasteler√≠a", "Tortas", "Lemon Pie", "Tarta de lim√≥n con merengue italiano.", "$2000", "destacado"],
    
    ["Pasteler√≠a", "Cookies", "Cookie Chips", "Galleta artesanal con chips de chocolate.", "$900"],
    ["Pasteler√≠a", "Cookies", "Cookie Red Velvet", "Galleta roja con chocolate blanco.", "$950"],
    
    ["Sandwiches", "", "Tostado de Jam√≥n y Queso", "Pan casero, jam√≥n cocido y queso.", "$2000"],
    ["Sandwiches", "", "Bagel Capresse", "Bagel artesanal, tomate, mozzarella y albahaca.", "$2300", "vegetariano"],
    ["Sandwiches", "", "Croissant Veggie", "Croissant con vegetales grillados y queso.", "$2200", "vegano"],
    
    ["Desayunos", "", "Combo Central", "Caf√© + jugo + tostadas + mermelada y manteca.", "$2500"],
    ["Bebidas", "Jugos Naturales", "Jugo de Naranja Natural", "Jugo exprimido al momento.", "$800"],
    ["Bebidas", "Jugos Naturales", "Jugo de Manzana y Zanahoria", "Fresco y revitalizante.", "$900"],
    
    ["Saludables", "Yogur", "Yogur Natural", "Limonada casera con menta y albahaca.", "$850"],
    ["Saludables", "Yogur", "Yogur con Granola y Frutas", "Yogur natural con granola y frutas de estaci√≥n", "$2000", "celiaco"],
    
    ["Desayunos", "", "Granola Bowl", "Yogur natural, granola casera y frutas frescas.", "$1800"],
    ["Desayunos", "", "Tostadas Avocado", "Pan integral, palta, tomate y semillas.", "$2100", "vegano"],
    
    ["Cafeter√≠a", "Especiales", "Mocha Latte", "Caf√© espresso con leche vaporizada y chocolate.", "$1700"],
    ["Cafeter√≠a", "Especiales", "Caramel Macchiato", "Espresso con leche, espuma y toque de caramelo.", "$1750"],
    
    ["Cafeter√≠a", "Fr√≠os", "Espresso Tonic", "Espresso servido sobre t√≥nica y hielo.", "$1600"],
    ["Cafeter√≠a", "Fr√≠os", "Affogato", "Helado de vainilla ba√±ado con espresso caliente.", "$1900", "celiaco"],
    ["Cafeter√≠a", "Fr√≠os", "Iced Matcha Latte", "T√© matcha japon√©s con leche vegetal y hielo.", "$1800", "vegano"],
    
    ["Cafeter√≠a", "Fr√≠os", "Frappuccino Oreo", "Frapp√© de caf√© con galletas Oreo y crema.", "$2000"],
    ["Cafeter√≠a", "Fr√≠os", "Limonada Menta & Jengibre", "Refrescante, casera y natural.", "$1500"],
    ["Cafeter√≠a", "Fr√≠os", "Smoothie Frutos Rojos", "Batido con yogur natural y frutas del bosque.", "$1900", "celiaco"],
    
    ["Pasteler√≠a", "", "Muffin de Banana Vegano", "Sin l√°cteos, sin huevo, con nueces y banana.", "$1300", "vegano"],
    ["Pasteler√≠a", "Reposter√≠a", "Cinnamon Roll", "Roll de canela con glaseado de vainilla.", "$1600"],
    ["Pasteler√≠a", "Reposter√≠a", "Mini Tarta de Manzana", "Tarta individual con manzana caramelizada.", "$1700"],
    
    ["Sandwiches", "", "Focaccia de Pollo", "Pan focaccia, pollo grillado, r√∫cula y pesto.", "$2400", "destacado"],
    ["Desayunos", "", "Huevos Benedicto", "Pan de campo, jam√≥n cocido, huevo poch√© y salsa holandesa.", "$2600"],
    ["Desayunos", "", "Brunch Central", "Huevos, tostadas, caf√©, jugo y mini torta.", "$3200", "celiaco", "destacado"],
    
    ["Pasteler√≠a", "Sin Gluten", "Brownie sin TACC", "Brownie h√∫medo con almendras sin gluten.", "$1400", "celiaco", "destacado"],
    ["Sandwiches", "", "Tostado Vegano", "Pan integral, hummus, palta y tomate seco.", "$2100", "vegano"],
    ["Sandwiches", "", "Croissant Capresse", "Croissant con tomate, albahaca y mozzarella.", "$2300", "vegetariano"]
  ];

function renderMenuForPrint(rows) {
  const container = document.querySelector("#menuTable");
  const agrupado = {};

  rows.forEach(cols => {
    const [cat, subcat, nombre, desc, precio, ...flags] = cols.map(c => (c || "").trim());
    if (!cat || !nombre) return;
    if (!agrupado[cat]) agrupado[cat] = {};
    const sub = subcat || "-";
    if (!agrupado[cat][sub]) agrupado[cat][sub] = [];
    agrupado[cat][sub].push({ nombre, desc, precio, flags });
  });
  Object.entries(agrupado).forEach(([cat, subs]) => {
    const catWrapper = document.createElement("div");
    const catTitle = document.createElement("h2");
    catTitle.textContent = cat;
    catWrapper.appendChild(catTitle);
    Object.entries(subs).forEach(([sub, items]) => {
      if (sub && sub !== "-") {
        const subTitle = document.createElement("h3");
        subTitle.textContent = sub;
        catWrapper.appendChild(subTitle);
      }
      items.forEach(item => {
        const div = document.createElement("div");
        div.className = "menu-item";
        if (item.flags.includes("destacado")) div.classList.add("destacado");

        // --- crear √≠conos seg√∫n flags ---
        const icons = [];
        if (item.flags.includes("celiaco")) {
          icons.push('<img class="icon-diet" src="https://res.cloudinary.com/drxznqm61/image/upload/v1760150815/download_4_yulmty.png" alt="Sin TACC" title="Sin TACC">');
        }
        if (item.flags.includes("vegano")) {
          icons.push('<img class="icon-diet" src="https://res.cloudinary.com/drxznqm61/image/upload/v1760150943/download_5_pupphw.png" alt="Apto Vegano" title="Apto Vegano">');
        }
        const iconsHTML = icons.length ? `<div class="diet-icons">${icons.join("")}</div>` : "";

        div.innerHTML = `
          <div class="menu-plate">
            <h4>
              <span class="diet-icons inline">${iconsHTML}</span>
              ${item.nombre}
            </h4>
            <p class="menu-description">${item.desc || ""}</p>
          </div>
          <span class="menu-price">${item.precio}</span>
        `;

        catWrapper.appendChild(div);
      });
    });

    container.appendChild(catWrapper);
  });
}


    renderMenuForPrint(allRows);

    // Set texts from CSS variables
    document.getElementById("nombre-resto").textContent = getComputedStyle(document.documentElement).getPropertyValue('--nombre-restaurante').replace(/"/g, '').trim();
    document.getElementById("subtitulo-resto").textContent = getComputedStyle(document.documentElement).getPropertyValue('--subtitulo-restaurante').replace(/"/g, '').trim();
    document.getElementById("direccion-resto").textContent = getComputedStyle(document.documentElement).getPropertyValue('--direccion-restaurante').replace(/"/g, '').trim();
    document.getElementById("horario-resto").textContent = getComputedStyle(document.documentElement).getPropertyValue('--horario-restaurante').replace(/"/g, '').trim();
    document.getElementById("telefono-resto").textContent = getComputedStyle(document.documentElement).getPropertyValue('--telefono-restaurante').replace(/"/g, '').trim();

    document.querySelectorAll('#topMenu input[type="color"]').forEach(input => {
      input.addEventListener('input', function() {
        const varName = this.id;
        const color = this.value;
        document.documentElement.style.setProperty(`--${varName}`, color);
        localStorage.setItem(varName, color); 
      });
    });

    document.querySelectorAll('#topMenu input[type="color"]').forEach(input => {
      const saved = localStorage.getItem(input.id);
      if (saved) {
        input.value = saved;
        document.documentElement.style.setProperty(`--${input.id}`, saved);
      }
    });

    // Tipo de firulete
    const firuleteSelector = document.getElementById("firuleteSelector");
    if (firuleteSelector && firuleteSelector.tagName === 'SELECT') {
      firuleteSelector.addEventListener("change", function () {
        const val = this.value;
        document.documentElement.style.setProperty("--firulete", `"${val}"`);
        localStorage.setItem("firulete", val);
      });
    }

    // Recuperar tipo guardado
    const savedFirulete = localStorage.getItem("firulete");
    if (savedFirulete) {
      firuleteSelector.value = savedFirulete;
      document.documentElement.style.setProperty("--firulete", `"${savedFirulete}"`);
    }

    // === COLOR MAESTRO ===
    const masterColorContainer = document.getElementById("masterColorContainer");
    const masterColorInput = document.getElementById("masterColor");

    // Aplicar color maestro a todos los seleccionados
    masterColorInput.addEventListener("input", () => {

      const newColor = masterColorInput.value;
      const selectedCheckboxes = Array.from(document.querySelectorAll("#colorMenu .color-group")).filter(cb => cb.checked);

      selectedCheckboxes.forEach(cb => {
        const input = cb.nextElementSibling;
        if (!input) return;
        input.value = newColor;
        const varName = input.id;
        document.documentElement.style.setProperty(`--${varName}`, newColor);
        localStorage.setItem(varName, newColor);
      });
    });

    const presets = {
      1: { // ‚òï Vintage - elegante y c√°lido
        bodyFont: 'cormorant-garamond',
        headingFont: "'Playfair Display', serif",
        sizes: { logo: 120, nombre: 2.5, slogan: 1.15, categoria: 3.4, subcategoria: 1.3, plato: 1.05, descripcion: 0.9, precio: 1.0, info: 0.9 },
        colors: {
          'color-nombre-resto': '#3b2407',
          'color-nombre-slogan': '#795028',
          'color-categoria': '#3b2407',
          'color-subcategoria': '#6e4b2d',
          'color-plato': '#1f1a16',
          'color-descripcion': '#5a4739',
          'color-precio': '#3b2407',
          'color-info-resto': '#3b2407',
          'color-firulete': '#b77b46',
          'bg-opacity': '0.1',
          'menu-columns': '1'
        },
        firulete: '‚öú ‚öú ‚öú'
      },
      2: { // üåø Natural Pastel - limpio y fresco
        bodyFont: 'lato',
        headingFont: "'Unbounded', sans-serif",
        sizes: { logo: 110, nombre: 2.1, slogan: 1.0, categoria: 2.8, subcategoria: 1.2, plato: 1.05, descripcion: 0.9, precio: 1.0, info: 0.9 },
        colors: {
          'color-nombre-resto': '#3b5a2b',
          'color-nombre-slogan': '#5b8c4f',
          'color-categoria': '#355c2e',
          'color-subcategoria': '#5c8050',
          'color-plato': '#222',
          'color-descripcion': '#4e6344',
          'color-precio': '#3b5a2b',
          'color-info-resto': '#3b5a2b',
          'color-firulete': '#628d4a',
          'bg-opacity': '0.1',
          'menu-columns': '2'
        },
        firulete: 'üçÉ ‚úø üçÉ'
      },
      3: { // ‚ö´ Minimalista Gris - moderno y legible
        bodyFont: 'montserrat',
        headingFont: "'Oswald', sans-serif",
        sizes: { logo: 90, nombre: 1.9, slogan: 1.0, categoria: 3.0, subcategoria: 1.2, plato: 1.0, descripcion: 0.85, precio: 1.0, info: 0.85 },
        colors: {
          'color-nombre-resto': '#222',
          'color-nombre-slogan': '#444',
          'color-categoria': '#000',
          'color-subcategoria': '#333',
          'color-plato': '#111',
          'color-descripcion': '#555',
          'color-precio': '#c0392b',
          'color-info-resto': '#333',
          'color-firulete': '#666',
          'bg-opacity': '0.1',
          'menu-columns': '3'
        },
        firulete: '‚ãÑ ‚ãÑ ‚ãÑ'
      },
      4: { // üíé Dorado Moderno - elegante sin perder contraste
        bodyFont: 'playfair',
        headingFont: "'Cormorant Garamond', serif",
        sizes: { logo: 130, nombre: 2.6, slogan: 1.15, categoria: 3.8, subcategoria: 1.3, plato: 1.05, descripcion: 0.9, precio: 1.05, info: 0.9 },
        colors: {
          'color-nombre-resto': '#8a6d2f',
          'color-nombre-slogan': '#b39243',
          'color-categoria': '#7c611e',
          'color-subcategoria': '#b39243',
          'color-plato': '#111',
          'color-descripcion': '#444',
          'color-precio': '#7c611e',
          'color-info-resto': '#333',
          'color-firulete': '#b39243',
          'bg-opacity': '0.1',
          'menu-columns': '1'
        },
        firulete: '‚ú§ ‚ú§ ‚ú§'
      },
      5: { // üìú Italiano Cl√°sico - c√°lido y sobrio
        bodyFont: 'merriweather',
        headingFont: "'Playfair Display', serif",
        sizes: { logo: 120, nombre: 2.4, slogan: 1.05, categoria: 3.2, subcategoria: 1.25, plato: 1.05, descripcion: 0.9, precio: 1.0, info: 0.9 },
        colors: {
          'color-nombre-resto': '#7a1b1b',
          'color-nombre-slogan': '#a73535',
          'color-categoria': '#601010',
          'color-subcategoria': '#8c3a3a',
          'color-plato': '#222',
          'color-descripcion': '#555',
          'color-precio': '#601010',
          'color-info-resto': '#333',
          'color-firulete': '#8c3a3a',
          'bg-opacity': '0.1',
          'menu-columns': '2'
        },
        firulete: '‚ùß ‚ùß ‚ùß'
      },
      6: { // ü©µ Celeste Moderno - suave pero definido
        bodyFont: 'sora',
        headingFont: "'Syne', sans-serif",
        sizes: { logo: 100, nombre: 2.2, slogan: 1.0, categoria: 2.9, subcategoria: 1.25, plato: 1.05, descripcion: 0.9, precio: 1.0, info: 0.9 },
        colors: {
          'color-nombre-resto': '#003f73',
          'color-nombre-slogan': '#2978b5',
          'color-categoria': '#004b8d',
          'color-subcategoria': '#2271a1',
          'color-plato': '#111',
          'color-descripcion': '#555',
          'color-precio': '#004b8d',
          'color-info-resto': '#004b8d',
          'color-firulete': '#2978b5',
          'bg-opacity': '0.1',
          'menu-columns': '3'
        },
        firulete: '‚ú¶ ‚ú¶ ‚ú¶'
      },
      7: { // üçÇ Oto√±al Suave - gourmet y elegante
        bodyFont: 'lato',
        headingFont: "'Yeseva One', serif",
        sizes: { logo: 125, nombre: 2.5, slogan: 1.05, categoria: 3.4, subcategoria: 1.3, plato: 1.05, descripcion: 0.9, precio: 1.05, info: 0.9 },
        colors: {
          'color-nombre-resto': '#8a4b23',
          'color-nombre-slogan': '#c36b3e',
          'color-categoria': '#703d1b',
          'color-subcategoria': '#a5572c',
          'color-plato': '#222',
          'color-descripcion': '#5a4434',
          'color-precio': '#703d1b',
          'color-info-resto': '#3a2b20',
          'color-firulete': '#a5572c',
          'bg-opacity': '0.1',
          'menu-columns': '1'
        },
        firulete: '‚ú§ ‚ú§ ‚ú§'
      },
      8: { // ‚ö° Tech Futurista - limpio y tecnol√≥gico
        bodyFont: 'unbounded',
        headingFont: "'Source Code Pro', monospace",
        sizes: { logo: 95, nombre: 2.3, slogan: 1.0, categoria: 3.6, subcategoria: 1.3, plato: 1.05, descripcion: 0.9, precio: 1.0, info: 0.9 },
        colors: {
          'color-nombre-resto': '#0077B6',
          'color-nombre-slogan': '#0096C7',
          'color-categoria': '#023E8A',
          'color-subcategoria': '#0077B6',
          'color-plato': '#111',
          'color-descripcion': '#555',
          'color-precio': '#023E8A',
          'color-info-resto': '#222',
          'color-firulete': '#0096C7',
          'bg-opacity': '0.1',
          'menu-columns': '2'
        },
        firulete: '‚ö° ‚ö° ‚ö°'
      },
      9: { // üé® Pop Alegre - colorido pero legible
        bodyFont: 'righteous',
        headingFont: "'Montserrat', sans-serif",
        sizes: { logo: 100, nombre: 2.4, slogan: 1.0, categoria: 3.5, subcategoria: 1.25, plato: 1.05, descripcion: 0.9, precio: 1.05, info: 0.9 },
        colors: {
          'color-nombre-resto': '#D62828',
          'color-nombre-slogan': '#F77F00',
          'color-categoria': '#F94144',
          'color-subcategoria': '#F8961E',
          'color-plato': '#222',
          'color-descripcion': '#555',
          'color-precio': '#D62828',
          'color-info-resto': '#333',
          'color-firulete': '#F8961E',
          'bg-opacity': '0.1',
          'menu-columns': '3'
        },
        firulete: '‚ú® üí´ ‚ú®'
      },
      10: { // ü§ç Blanco Neutro - sobrio y balanceado
        bodyFont: 'lato',
        headingFont: "'Montserrat', sans-serif",
        sizes: { logo: 105, nombre: 2.1, slogan: 1.0, categoria: 3.0, subcategoria: 1.2, plato: 1.05, descripcion: 0.9, precio: 1.0, info: 0.9 },
        colors: {
          'color-nombre-resto': '#111',
          'color-nombre-slogan': '#444',
          'color-categoria': '#111',
          'color-subcategoria': '#555',
          'color-plato': '#111',
          'color-descripcion': '#555',
          'color-precio': '#000',
          'color-info-resto': '#333',
          'color-firulete': '#777',
          'bg-opacity': '0.1',
          'menu-columns': '1'
        },
        firulete: '‚ãÑ ‚ãÑ ‚ãÑ'
      }
    };

    const sizeKeys = [
      {key: 'logo-size', min: 50, max: 220, step: 1, unit: 'px'},
      {key: 'size-nombre-resto', min:1, max:4, step:0.01},
      {key: 'size-nombre-slogan', min:0.6, max:2, step:0.01},
      {key: 'size-categoria', min:0.8, max:3, step:0.01},
      {key: 'size-subcategoria', min:0.6, max:2, step:0.01},
      {key: 'size-plato', min:0.5, max:2, step:0.01},
      {key: 'size-descripcion', min:0.4, max:1.5, step:0.01},
      {key: 'size-precio', min:0.5, max:2, step:0.01},
      {key: 'size-info-resto', min:0.4, max:1.5, step:0.01},
    ];

    sizeKeys.forEach(cfg => {
      const key = cfg.key;
      const range = document.getElementById(`${key}-range`);
      const num = document.getElementById(`${key}-number`);
      if (!range || !num) return;

      const unit = cfg.unit || 'rem'; // respeta unit si est√° definida

      // cargar valor guardado o tomar el CSS variable actual
      const saved = localStorage.getItem(key);
      if (saved) {
        // saved ya est√° sin unidad
        range.value = saved;
        num.value = saved;
        document.documentElement.style.setProperty(`--${key}`, saved + (unit === 'rem' ? 'rem' : unit));
      } else {
        // obtener valor desde :root (si existe) y quitar unidad adecuada
        const computed = getComputedStyle(document.documentElement).getPropertyValue(`--${key}`).trim();
        if (computed) {
          const numeric = parseFloat(computed.replace('rem','').replace('px','')) || parseFloat(computed);
          if (!isNaN(numeric)) {
            range.value = numeric;
            num.value = numeric;
            document.documentElement.style.setProperty(`--${key}`, numeric + (unit === 'rem' ? 'rem' : unit));
          }
        }
      }

      // sincronizar range -> number -> css -> storage
      const apply = v => {
        // normalizar n√∫mero
        const raw = (typeof v === 'string') ? v : String(v);
        const valNum = unit === 'px' ? Math.round(parseFloat(raw) || cfg.min) : parseFloat(raw) || cfg.min;
        const out = unit === 'px' ? String(Math.round(valNum)) : String(Number(valNum).toFixed(2));
        num.value = out;
        range.value = out;
        document.documentElement.style.setProperty(`--${key}`, out + (unit === 'rem' ? 'rem' : unit));
        localStorage.setItem(key, out);
      };

      range.addEventListener('input', e => apply(e.target.value));
      num.addEventListener('input', e => {
        let v = parseFloat(e.target.value);
        if (isNaN(v)) v = cfg.min;
        if (v < cfg.min) v = cfg.min;
        if (v > cfg.max) v = cfg.max;
        // aplicar con precision seg√∫n unidad
        apply(unit === 'px' ? Math.round(v) : v.toFixed(2));
      });
    });

  (function(){
    // Colores: correcci√≥n de almacenamiento y guardado seguro
    const sameColorToggle = document.getElementById("sameColorMode");
    const colorMenu = document.getElementById("colorMenu");
    const colorGroups = document.querySelectorAll(".color-group");
    const colorPickers = document.querySelectorAll('#colorMenu input[type="color"]');

    if (sameColorToggle) {
      sameColorToggle.addEventListener("change", () => {
        const active = sameColorToggle.checked;
        if (active) colorMenu.classList.add("active"); else colorMenu.classList.remove("active");
        colorGroups.forEach(cb => (cb.checked = false));
        // mostrar/ocultar master
        const masterColorContainer = document.getElementById("masterColorContainer");
        if (masterColorContainer) masterColorContainer.style.display = active ? "flex" : "none";
      });
    }

    colorPickers.forEach(picker => {
      // aplicar color guardado si existe
      const saved = localStorage.getItem(picker.id);
      if (saved) {
        picker.value = saved;
        document.documentElement.style.setProperty(`--${picker.id}`, saved);
      }

      picker.addEventListener("input", () => {
        const selectedCheckboxes = Array.from(colorGroups).filter(cb => cb.checked);
        const newColor = picker.value;
        const varName = picker.id;

        // Aplica color normalmente y guarda con clave=variable, valor=color
        document.documentElement.style.setProperty(`--${varName}`, newColor);
        localStorage.setItem(varName, newColor);

        // Si est√° activo el modo y hay varios seleccionados ‚Üí aplica a todos
        if (sameColorToggle && sameColorToggle.checked && selectedCheckboxes.length > 1) {
          selectedCheckboxes.forEach(cb => {
            const input = cb.nextElementSibling;
            if (!input) return;
            input.value = newColor;
            const name = input.id;
            document.documentElement.style.setProperty(`--${name}`, newColor);
            localStorage.setItem(name, newColor);
          });
        }
      });
    });

    // Master color input
    const masterColorInput = document.getElementById("masterColor");
    if (masterColorInput) {
      masterColorInput.addEventListener("input", () => {
        if (!sameColorToggle || !sameColorToggle.checked) return;
        const newColor = masterColorInput.value;
        const selectedCheckboxes = Array.from(document.querySelectorAll("#colorMenu .color-group")).filter(cb => cb.checked);
        selectedCheckboxes.forEach(cb => {
          const input = cb.nextElementSibling;
          if (!input) return;
          input.value = newColor;
          const varName = input.id;
          document.documentElement.style.setProperty(`--${varName}`, newColor);
                   localStorage.setItem(varName, newColor);
        });
      });
    }

    document.querySelectorAll("#firuleteSelector label").forEach(label => {
      label.addEventListener("click", () => {
        const val = label.dataset.value || "";
        document.documentElement.style.setProperty("--firulete", `"${val}"`);
        localStorage.setItem("firulete", val);

        // üîΩ Cierra el men√∫ despu√©s del click
        const dropdown = label.closest(".dropdown");
        if (dropdown) {
          const content = dropdown.querySelector(".dropdown-content");
          if (content) content.style.display = "none";
          setTimeout(() => (content.style.display = ""), 200); // restaura comportamiento hover
        }
      });
    });

  document.querySelectorAll("#presetSelectorMenu label").forEach(label => {
    label.addEventListener("click", () => {
      const val = label.dataset.value;
      if (!val || !presets[val]) return;
      const preset = presets[val];

      // üîπ Aplica fuente base
      const families = {
        arial: "Arial, sans-serif",
        oswald: "'Oswald', Arial, sans-serif",
        "roboto-slab": "'Roboto Slab', serif",
        pacifico: "'Pacifico', cursive",
        lato: "'Lato', Arial, sans-serif",
        merriweather: "'Merriweather', serif",
        montserrat: "'Montserrat', Arial, sans-serif",
        "indie-flower": "'Indie Flower', cursive",
        playfair: "'Playfair Display', serif",
        "source-code": "'Source Code Pro', monospace",
        unbounded: "'Unbounded', sans-serif",
        syne: "'Syne', sans-serif",
        sora: "'Sora', sans-serif",
        staatliches: "'Staatliches', sans-serif",
        caveat: "'Caveat', cursive",
        "yeseva-one": "'Yeseva One', serif",
        righteous: "'Righteous', cursive",
        "cormorant-garamond": "'Cormorant Garamond', serif"
      };

      document.body.style.fontFamily =
        families[preset.bodyFont] || "Arial, sans-serif";

      // üîπ Aplica fuentes a headings
      document
        .querySelectorAll("h1, h2, h3, h4")
        .forEach(el => (el.style.fontFamily = preset.headingFont));

      // üîπ Tama√±os (corrige logo y unidades)
      const s = preset.sizes || {};
      const keyMap = {
        logo: '--logo-size',
        nombre: '--size-nombre-resto',
        slogan: '--size-nombre-slogan',
        categoria: '--size-categoria',
        subcategoria: '--size-subcategoria',
        plato: '--size-plato',
        descripcion: '--size-descripcion',
        precio: '--size-precio',
        info: '--size-info-resto'
      };

      for (const [k, v] of Object.entries(s)) {
        const cssVar = keyMap[k];
        if (!cssVar) continue;

        // Aplica unidades correctas
        const isLogo = k === 'logo';
        const unit = isLogo ? 'px' : 'rem';
        document.documentElement.style.setProperty(cssVar, v + unit);

        // Persistencia coherente con el resto del c√≥digo
        const storageKey = cssVar.replace(/^--/, ''); // ej: 'size-nombre-resto'
        localStorage.setItem(storageKey, String(v));

        // Sincroniza controles si existen
        const rangeId = isLogo ? 'logo-size-range' : storageKey + '-range';
        const numId   = isLogo ? 'logo-size-number' : storageKey + '-number';
        const rangeEl = document.getElementById(rangeId);
        const numEl   = document.getElementById(numId);
        if (rangeEl) rangeEl.value = v;
        if (numEl)   numEl.value   = v;
      }

      // üîπ Colores
      for (const [key, color] of Object.entries(preset.colors || {})) {
        document.documentElement.style.setProperty(`--${key}`, color);
        localStorage.setItem(key, color);
        const input = document.getElementById(key);
        if (input) input.value = color;
      }

      // === APLICA COLUMNAS SI EL PRESET LAS DEFINE ===
      if (preset.colors && preset.colors["menu-columns"]) {
        const cols = preset.colors["menu-columns"];
        document.documentElement.style.setProperty("--menu-columns", cols);
        document.body.style.columnCount = cols;
        localStorage.setItem("menu-columns", cols);

        // üîπ opcional: sincronizar visualmente el selector de columnas
        const options = document.querySelectorAll("#columnsMenu label[data-value]");
        options.forEach(opt => {
          opt.classList.toggle("active", String(opt.dataset.value) === String(cols));
        });
      }

      // üîπ Firulete y opacidad
      if (preset.firulete) {
        document.documentElement.style.setProperty(
          "--firulete",
          `"${preset.firulete}"`
        );
        localStorage.setItem("firulete", preset.firulete);
      }

      // üîπ Cierra men√∫ tras clic
      const dropdown = label.closest(".dropdown");
      const content = dropdown?.querySelector(".dropdown-content");
      if (content) {
        content.style.display = "none";
        setTimeout(() => (content.style.display = ""), 200);
      }
    });
  });

  // Handler del men√∫ de fuentes por label
  document.querySelectorAll("#fontSelectorMenu label").forEach(label => {
    label.addEventListener("click", () => {
      const val = label.dataset.value;
      const families = {
        arial: "Arial, sans-serif",
        oswald: "'Oswald', Arial, sans-serif",
        "roboto-slab": "'Roboto Slab', serif",
        pacifico: "'Pacifico', cursive",
        lato: "'Lato', Arial, sans-serif",
        merriweather: "'Merriweather', serif",
        montserrat: "'Montserrat', Arial, sans-serif",
        "indie-flower": "'Indie Flower', cursive",
        playfair: "'Playfair Display', serif",
        "source-code": "'Source Code Pro', monospace",
        unbounded: "'Unbounded', sans-serif",
        syne: "'Syne', sans-serif",
        sora: "'Sora', sans-serif",
        staatliches: "'Staatliches', sans-serif",
        caveat: "'Caveat', cursive",
        "yeseva-one": "'Yeseva One', serif",
        righteous: "'Righteous', cursive",
        "cormorant-garamond": "'Cormorant Garamond', serif"
      };
      document.body.style.fontFamily = families[val] || "Arial, sans-serif";
      localStorage.setItem("font-family", val);

      const dropdown = label.closest(".dropdown");
      const content = dropdown?.querySelector(".dropdown-content");
      if (content) {
        content.style.display = "none";
        setTimeout(() => (content.style.display = ""), 200);
      }
    });
  });

  })();

  (function(){
    const menu = document.getElementById('columnsMenu');
    if (!menu) return;
    const options = Array.from(menu.querySelectorAll('label[data-value]'));

    const apply = (v) => {
      const n = Math.min(3, Math.max(1, parseInt(v) || 2));
      document.documentElement.style.setProperty('--menu-columns', n);
      document.body.style.columnCount = n;
      localStorage.setItem('menu-columns', String(n));
      options.forEach(opt => opt.classList.toggle('active', String(opt.dataset.value) === String(n)));
    };

    // inicializar desde localStorage o desde la variable CSS
    const saved = localStorage.getItem('menu-columns') || getComputedStyle(document.documentElement).getPropertyValue('--menu-columns').trim();
    apply(saved);

    options.forEach(opt => {
      opt.addEventListener('click', () => {
        apply(opt.dataset.value);
        // cerrar dropdown brevemente (mantener comportamiento hover)
        const dropdown = opt.closest('.dropdown');
        const content = dropdown?.querySelector('.dropdown-content');
        if (content) {
          content.style.display = 'none';
          setTimeout(() => (content.style.display = ''), 180);
        }
      });
    });

    // observar cambios por JS/presets para sincronizar clases activas
    const observer = new MutationObserver(() => {
      const v = getComputedStyle(document.documentElement).getPropertyValue('--menu-columns').trim();
      options.forEach(opt => opt.classList.toggle('active', String(opt.dataset.value) === String(v)));
    });
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['style'] });
  })();

  // ===== BG OPACITY + LOGO URL controls =====
  (function(){
    const bgRange = document.getElementById('bg-opacity');
      const bgNum = document.getElementById('bg-opacity-number');
      const logoUrlInput = document.getElementById('logo-url-input');
      const applyLogoBtn = document.getElementById('applyLogoUrl');
      
      // init from storage
      const savedBg = localStorage.getItem('bg-opacity') || bgRange.value || '0.2';
      if (bgRange) { bgRange.value = savedBg; document.documentElement.style.setProperty('--bg-opacity', savedBg); }
      if (bgNum) { bgNum.value = savedBg; }

      bgRange?.addEventListener('input', (e) => {
        const v = e.target.value;
        document.documentElement.style.setProperty('--bg-opacity', v);
        if (bgNum) bgNum.value = v;
        localStorage.setItem('bg-opacity', v);
      });
      bgNum?.addEventListener('input', (e) => {
        let v = parseFloat(e.target.value);
        if (isNaN(v)) v = 0;
        if (v < 0) v = 0; if (v > 0.5) v = 0.5;
        document.documentElement.style.setProperty('--bg-opacity', v);
        if (bgRange) bgRange.value = v;
        localStorage.setItem('bg-opacity', String(v));
      });
        
      // logo url init / apply
      const savedLogo = localStorage.getItem('logo-url');
      if (savedLogo) {
        const imgs = document.querySelectorAll('.resto-header img, .cover-page img, #logo-caratula');
        imgs.forEach(i => i.src = savedLogo);
        if (logoUrlInput) logoUrlInput.value = savedLogo;
      }
      applyLogoBtn?.addEventListener('click', () => {
        const url = (logoUrlInput.value || '').trim();
        if (!url) return;
        const imgs = document.querySelectorAll('.resto-header img, .cover-page img, #logo-caratula');
        imgs.forEach(i => i.src = url);
        localStorage.setItem('logo-url', url);
      });

    const sizeRange = document.getElementById('bg-size');
    const sizeNum = document.getElementById('bg-size-number');
    const savedSize = localStorage.getItem('bg-size-scale') || '100';
    sizeRange.value = savedSize;
    sizeNum.value = savedSize;

    document.documentElement.style.setProperty('--bg-size-scale', savedSize + '%');
      const applySize = v => {
        const n = Math.min(200, Math.max(50, parseInt(v) || 100));
        sizeRange.value = n;
        sizeNum.value = n;
        document.documentElement.style.setProperty('--bg-size-scale', n + '%');
        localStorage.setItem('bg-size-scale', String(n));
      };
      sizeRange.addEventListener('input', e => applySize(e.target.value));
      sizeNum.addEventListener('input', e => applySize(e.target.value));

    })();
  
    // ===== Tracking (letter-spacing) control =====
    (function(){
      // insert UI: (controls already placed in Tama√±os dropdown? if not, you can add them there)
      // Here we expect inputs with ids: tracking-range and tracking-number. If not present, create simple controls programmatically.
      let trackingRange = document.getElementById('tracking-range');
      let trackingNum = document.getElementById('tracking-number');
      // if controls are not in DOM, create hidden ones (graceful)
      if (!trackingRange || !trackingNum) {
        // create elements inside sizeMenu if exists
        const sizeMenu = document.getElementById('sizeMenu');
        if (sizeMenu) {
          const label = document.createElement('label');
          label.style = 'display:flex;justify-content:space-between;align-items:center;gap:8px;';
          label.innerHTML = `<span>Interespaciado</span><input type="number" id="tracking-number" step="0.1" style="width:64px;">`;
          sizeMenu.appendChild(label);
          const range = document.createElement('input');
          range.type = 'range';
          range.id = 'tracking-range';
          range.min = -1; range.max = 4; range.step = 0.1; range.style.width = '100%';
          sizeMenu.appendChild(range);
          trackingRange = document.getElementById('tracking-range');
          trackingNum = document.getElementById('tracking-number');
        } else {
          return; // nothing to do
        }
      }

      // init
      const savedTracking = localStorage.getItem('tracking') || '0';
      trackingRange.value = savedTracking;
      trackingNum.value = savedTracking;
      document.documentElement.style.setProperty('--tracking', savedTracking + 'px');

      function applyTracking(v){
        const n = Number(v) || 0;
        trackingRange.value = n;
        trackingNum.value = n;
        document.documentElement.style.setProperty('--tracking', n + 'px');
        localStorage.setItem('tracking', String(n));
      }

      trackingRange.addEventListener('input', (e) => applyTracking(e.target.value));
      trackingNum.addEventListener('input', (e) => {
        let v = parseFloat(e.target.value);
        if (isNaN(v)) v = 0;
        applyTracking(v);
      });
    })();

  (function(){
  const sameSizeToggle = document.getElementById("sameSizeMode");
  const sizeMenu = document.getElementById("sizeMenu");
  const sizeGroups = document.querySelectorAll("#sizeMenu .size-group");
  const masterSizeContainer = document.getElementById("masterSizeContainer");
  const masterSizeRange = document.getElementById("masterSizeRange");

  // almacenar√° los valores originales al activar el modo
  let baseValues = {};
  let baseMaster = 1;

  sameSizeToggle?.addEventListener("change", () => {
    const active = sameSizeToggle.checked;
    sizeMenu.classList.toggle("active", active);
    sizeGroups.forEach(cb => (cb.checked = false));
    masterSizeContainer.style.display = active ? "flex" : "none";

    // cuando se activa, registramos los valores actuales
    if (active) {
      baseValues = {};
      document.querySelectorAll('#sizeMenu input[type="number"]').forEach(num => {
        const id = num.id;
        baseValues[id] = parseFloat(num.value) || 1;
      });
      baseMaster = parseFloat(masterSizeRange.value) || 1;
    }
  });
  function getRangeFor(numInput) {
    const id = numInput.id.replace("-number", "-range");
    return document.getElementById(id);
  }

  masterSizeRange?.addEventListener("input", e => {
    const newMaster = parseFloat(e.target.value);
    const selected = Array.from(sizeGroups).filter(cb => cb.checked);
    if (!selected.length || !sameSizeToggle.checked) return;

    // calcular factor proporcional
    const factor = newMaster / baseMaster;

    selected.forEach(cb => {
      const numInput = cb.parentElement.querySelector('input[type="number"]');
      if (!numInput) return;
      const rangeInput = getRangeFor(numInput);
      const id = numInput.id;
      const cssVar = id.replace('-number', '');
      const isLogo = cssVar === 'logo-size';
      const unit = isLogo ? 'px' : 'rem';

      const original = baseValues[id] || parseFloat(numInput.value) || 1;
      const newVal = (original * factor).toFixed(isLogo ? 0 : 2);

      numInput.value = newVal;
      if (rangeInput) rangeInput.value = newVal;
      document.documentElement.style.setProperty(`--${cssVar}`, newVal + unit);
      localStorage.setItem(cssVar, newVal);
      });
    });
  })();

// === EXPORTAR / IMPORTAR CONFIGURACI√ìN COMPLETA (con c√≥digo √∫nico) ===
(function () {
  const presetMenu = document.getElementById("presetSelectorMenu");
  if (!presetMenu) return;

  // === Crear UI dentro de "üåà Estilos" ===
  const divider = document.createElement("hr");
  divider.style.margin = "10px 0";
  const label = document.createElement("label");
  label.style.display = "block";
  label.style.fontSize = "0.85rem";
  label.style.color = "#333";
  label.style.marginBottom = "4px";
  label.textContent = "üíæ Cargar c√≥digo:";

  const textarea = document.createElement("textarea");
  textarea.id = "configJSON";
  textarea.placeholder = "Peg√° aqu√≠ el c√≥digo o JSON de tu dise√±o‚Ä¶";
  textarea.style.cssText = `
    width:100%;
    height:70px;
    font-size:0.75rem;
    font-family:monospace;
    resize:none;
    border:1px solid #ddd;
    border-radius:6px;
    padding:6px;
    box-sizing:border-box;
  `;

  const btnContainer = document.createElement("div");
  btnContainer.style.textAlign = "center";
  btnContainer.style.marginTop = "6px";
  
  const loadBtn = document.createElement("button");
  loadBtn.textContent = "üì• Aplicar C√≥digo";
  loadBtn.className = "dropbtn";
  loadBtn.style.fontSize = "0.8rem";
  loadBtn.style.padding = "6px 12px";
  loadBtn.style.backgroundColor = "#4CAF50";

  const saveBtn = document.createElement("button");
  saveBtn.textContent = "üíæ Guardar Configuraci√≥n";
  saveBtn.className = "dropbtn";
  saveBtn.style.fontSize = "0.8rem";
  saveBtn.style.padding = "6px 12px";
  saveBtn.style.marginRight = "6px";
  
  btnContainer.appendChild(loadBtn);
  
  const dividerLine = document.createElement("hr");
  dividerLine.style.cssText = "width:100%;margin:8px auto;border:0;border-top:1px solid #aaa;";
  btnContainer.appendChild(dividerLine);


  btnContainer.appendChild(saveBtn);

  presetMenu.appendChild(divider);
  presetMenu.appendChild(label);
  presetMenu.appendChild(textarea);
  presetMenu.appendChild(btnContainer);

  // === VARIABLES INCLUIDAS EN EL JSON ===
  const VARS = [
    "--nombre-restaurante",
    "--subtitulo-restaurante",
    "--direccion-restaurante",
    "--horario-restaurante",
    "--telefono-restaurante",
    "--color-nombre-resto",
    "--color-nombre-slogan",
    "--color-categoria",
    "--color-subcategoria",
    "--color-plato",
    "--color-descripcion",
    "--color-precio",
    "--color-info-resto",
    "--color-bg",
    "--bg-opacity",
    "--logo-size",
    "--size-nombre-resto",
    "--size-nombre-slogan",
    "--size-categoria",
    "--size-subcategoria",
    "--size-plato",
    "--size-descripcion",
    "--size-precio",
    "--size-info-resto",
    "--tracking",
    "--menu-columns"
  ];

  function generarConfiguracion() {
    const root = getComputedStyle(document.documentElement);
    const config = {};

    // Recolecta TODAS las variables
    VARS.forEach(v => {
      config[v.replace("--", "")] = root.getPropertyValue(v).trim();
    });

    // Fuente principal
    config["bodyFont"] = document.body.style.fontFamily || getComputedStyle(document.body).fontFamily;

    // ‚úÖ Agregar cantidad de columnas
    const col = getComputedStyle(document.documentElement).getPropertyValue("--menu-columns").trim() || "2";
    config["menu-columns"] = col;

    const jsonMin = JSON.stringify(config);
    const encoded = btoa(unescape(encodeURIComponent(jsonMin)))
      .replace(/\+/g, "-")
      .replace(/\//g, "_")
      .replace(/=+$/, "");

    const jsonPretty = JSON.stringify(config, null, 2);
    return { json: jsonPretty, uniqueCode: encoded, config };
  }

  function aplicarConfiguracion(config) {
    for (const [key, valRaw] of Object.entries(config)) {
      let val = valRaw;

      if (typeof val === "string" && /^".*"$/.test(val.trim())) {
        val = val.trim().replace(/^"+|"+$/g, "");
      }

      const needsRem = key.startsWith("size-") && !key.includes("logo");
      const needsPx = key === "logo-size";

      if (key === "bodyFont") {
        document.body.style.fontFamily = val;
        continue;
      }

      if (needsRem && !val.endsWith("rem")) val = parseFloat(val) + "rem";
      if (needsPx && !val.endsWith("px")) val = parseFloat(val) + "px";

      document.documentElement.style.setProperty(`--${key}`, val);
      localStorage.setItem(key, val);
    }

    const get = k => (config[k] || "").replace(/^"+|"+$/g, "");
    document.getElementById("nombre-resto").textContent = get("nombre-restaurante");
    document.getElementById("subtitulo-resto").textContent = get("subtitulo-restaurante");
    document.getElementById("direccion-resto").textContent = get("direccion-restaurante");
    document.getElementById("horario-resto").textContent = get("horario-restaurante");
    document.getElementById("telefono-resto").textContent = get("telefono-restaurante");
  }

  function mostrarPopup(titulo, texto) {
    const overlay = document.createElement("div");
    overlay.style = `
      position:fixed;inset:0;
      background:rgba(0,0,0,0.5);
      display:flex;align-items:center;justify-content:center;
      z-index:9999;
    `;
    const modal = document.createElement("div");
    modal.style = `
      background:#fff;
      border-radius:10px;
      padding:20px;
      max-width:600px;
      width:90%;
      box-shadow:0 6px 20px rgba(0,0,0,0.3);
      font-family:monospace;
      text-align:center;
      overflow:auto;
      max-height:85vh;
    `;
    modal.innerHTML = `
      <h3 style="font-family:sans-serif;margin-top:0;">${titulo}</h3>
      <pre style="text-align:left;background:#f9f9f9;border:1px solid #ddd;border-radius:6px;padding:10px;white-space:pre-wrap;word-break:break-word;font-size:0.75rem;">${texto}</pre>
      <button id="copyCode" style="margin-top:8px;padding:6px 12px;border:none;border-radius:6px;background:#1D3557;color:white;cursor:pointer;">Copiar C√≥digo</button>
      <button id="closeModal" style="margin-top:10px;padding:8px 16px;border:none;border-radius:6px;background:#457B9D;color:white;cursor:pointer;">Cerrar</button>
    `;
    overlay.appendChild(modal);
    document.body.appendChild(overlay);

    modal.querySelector("#copyCode").addEventListener("click", () => {
      navigator.clipboard.writeText(texto);
      modal.querySelector("#copyCode").textContent = "‚úÖ Copiado!";
      setTimeout(() => (modal.querySelector("#copyCode").textContent = "Copiar C√≥digo"), 2000);
    });
    modal.querySelector("#closeModal").addEventListener("click", () => overlay.remove());
  }

  // === EVENTOS ===
  saveBtn.addEventListener("click", () => {
    const { json, uniqueCode } = generarConfiguracion();
    mostrarPopup("C√≥digo de Configuraci√≥n", uniqueCode);
  });

  loadBtn.addEventListener("click", () => {
    try {
      const valRaw = textarea.value.trim();
      if (!valRaw) return alert("Peg√° primero el c√≥digo o JSON.");

      let config;

      // ¬øParece JSON?
      const looksLikeJSON = valRaw.startsWith("{") && valRaw.endsWith("}");
      if (looksLikeJSON) {
        config = JSON.parse(valRaw);
      } else {
        // Trata como c√≥digo √∫nico (Base64 URL-safe)
        const decoded = decodeUniqueCode(valRaw);
        config = JSON.parse(decoded);
      }

      aplicarConfiguracion(config);
      mostrarPopup("Configuraci√≥n Aplicada", "El men√∫ fue actualizado correctamente ‚úÖ");
    } catch (e) {
      console.error(e);
      alert("El c√≥digo no se pudo decodificar correctamente. Verific√° que est√© completo.");
    }
  });

  // --- helper robusto ---
  function decodeUniqueCode(input) {
    // Limpia espacios, saltos, texto extra (ej: ‚ÄúC√≥digo √∫nico: ‚Ä¶‚Äù)
    let clean = (input.match(/[A-Za-z0-9\-_]+/g) || []).join('');

    // Vuelve desde URL-safe a Base64 est√°ndar
    clean = clean.replace(/-/g, '+').replace(/_/g, '/');

    // Rellena padding (=) si falta
    const pad = clean.length % 4;
    if (pad) clean += '='.repeat(4 - pad);

    // Decodifica en UTF-8
    const binary = atob(clean);
    const bytes = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
    return new TextDecoder().decode(bytes);
  }
  })();

  </script>
</body>
</html>
