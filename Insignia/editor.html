<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editor de MenÃº - MenuLab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="https://res.cloudinary.com/drxznqm61/image/upload/v1758652390/The_Pent_2_a8vhtp.jpg" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" 
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Grupo 1 -->
  <link href="https://fonts.googleapis.com/css2?family=Almendra+Display&family=Amatic+SC:wght@400;700&family=Anton&family=Caveat:wght@400;700&family=Codystar:wght@300;400&family=Cormorant+Garamond:wght@400;700&family=Coral+Pixels&display=swap" rel="stylesheet">

  <!-- Grupo 2 -->
  <link href="https://fonts.googleapis.com/css2?family=Ewert&family=Indie+Flower&family=Merriweather:wght@400;700&family=Milonga&family=Monoton&family=Montserrat:wght@400;700&family=Oswald:wght@400;700&display=swap" rel="stylesheet">

  <!-- Grupo 3 -->
  <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&family=Chokokutai&family=Pacifico&family=Playfair+Display:wght@400;700&family=Quicksand:wght@400;700&family=Ranchers:wght@400;700&family=Rubik+Wet+Paint&family=Sora:wght@400;700&family=Source+Code+Pro:wght@400;700&family=Tangerine:wght@400;700&family=Vast+Shadow&display=swap" rel="stylesheet">

  <style>
  :root {
    --primary: #457B9D;
    --primary-dark: #1D3557;
    --bg-light: #f9f9f9;
    --border: #ddd;
    --radius: 6px;
    --shadow: 0 2px 6px rgba(0,0,0,0.08);
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    font-family: 'Lato', sans-serif;
    background: var(--bg-light);
    height: 100vh;
    display: flex;
    overflow: hidden;
  }

  /* === PANEL IZQUIERDO === */
  #sideMenu {
    width: 320px;
    background: #fff;
    border-right: 1px solid var(--border);
    box-shadow: var(--shadow);
    height: 100vh;
    overflow-y: auto;
    overflow-x: hidden;
    position: relative;
    z-index: 10;
    transition: transform 0.3s ease;
  }

  #sideMenu h3 {
    text-align: center;
    background: var(--primary);
    color: #fff;
    padding: 14px;
    margin: 0;
    font-size: 1.05rem;
  }

  #sideMenu section {
    padding: 14px 16px;
    border-bottom: 1px solid #eee;
  }

  #sideMenu label, #sideMenu h4, #sideMenu h5 {
    display: block;
    margin-top: 6px;
    margin-bottom: 4px;
    font-size: 0.9rem;
    color: #333;
  }

  #sideMenu button,
  #sideMenu select,
  #sideMenu input[type="color"],
  #sideMenu input[type="range"] {
    width: 100%;
    margin-bottom: 8px;
  }

  #sideMenu button {
    background: var(--primary);
    color: #fff;
    border: none;
    padding: 8px 12px;
    border-radius: var(--radius);
    cursor: pointer;
    transition: background 0.2s;
  }

  #sideMenu button:hover {
    background: var(--primary-dark);
  }

  .item-config {
    margin-bottom: 10px;
  }

/* === Flechita animada para cada item interno === */
/* === Flechita animada en los Items === */
.item-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #f8f8f8;
  padding: 8px 10px;
  margin: 4px 0;
  border-radius: 6px;
  border: 1px solid #e0e0e0;
  font-size: 0.9rem;
  cursor: pointer;
  transition: background 0.25s ease, transform 0.25s ease;
  position: relative;
}

.item-header:hover {
  background: #eef6fa;
  color: #1D3557;
}

/* Flechita */
.item-header::after {
  content: "â–¶";
  font-size: 0.85rem;
  color: #1D3557;
  position: absolute;
  right: 10px;
  transition: transform 0.3s ease;
}

.item-config.active .item-header::after {
  transform: rotate(90deg);
}

/* Panel interno */
.item-panel {
  display: none;
  padding: 8px;
  border: 1px solid #ddd;
  margin-top: 4px;
  border-radius: 6px;
  background: #fff;
  animation: fadeIn 0.25s ease;
  margin-left: 10px;
}

.item-config.active .item-panel {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-3px); }
  to { opacity: 1; transform: translateY(0); }
}


/* === AJUSTES VISUALES DE VISTA PREVIA === */
#previewArea {
  flex: 1;
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  background: #f4f6f8;
  padding: 20px;            /* margen visual */
  box-sizing: border-box;
}

#previewFrame {
  flex: 1;                  /* se adapta automÃ¡ticamente */
  width: 100%;
  height: 100%;
  border: 1px solid #ccc;
  border-radius: 10px;
  background: #fff;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: block;
}


  /* === BOTÃ“N MOBILE === */
  #toggleMenu {
    display: none;
    position: fixed;
    top: 12px;
    left: 12px;
    background: var(--primary);
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 46px;
    height: 46px;
    font-size: 1.2rem;
    z-index: 20;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  @media (max-width: 768px) {
    #sideMenu {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      transform: translateX(-100%);
      background: rgba(255, 255, 255, 0.5); /* ğŸ”¹ Blanco con transparencia */
      backdrop-filter: blur(1px); /* ğŸ”¹ Difumina el fondo (efecto vidrio) */
    }
    #sideMenu.open {
      transform: translateX(0);
    }
    #toggleMenu {
      display: block;
    }
  }

/* === ESTILOS EXPANDIBLES === */
#estilos .style-group {
  margin-bottom: 10px;
  border: 1px solid #eee;
  border-radius: 6px;
  background: #fafafa;
  overflow: hidden;
}

#estilos .style-header {
  margin: 0;
  padding: 8px 10px;
  background: #f8f8f8;
  color: #333;
  font-size: 0.9rem;
  cursor: pointer;
  user-select: none;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-radius: 6px;
  border: 1px solid #eee;
  transition: background 0.2s ease;
}

#estilos .style-header:hover {
  background: #eef6fa;
  color: #1D3557;
  border-color: #d3e4f2;
}

/* ğŸ”¹ Flechita animada */
#estilos .style-header::after {
  content: "â–¶";
  font-size: 0.8rem;
  color: #555;
  transition: transform 0.3s ease;
}

#estilos .style-group.active .style-header::after {
  transform: rotate(90deg);
}

/* ğŸ”¹ Panel desplegable interno */
#estilos .style-panel {
  display: none;
  padding: 8px 10px;
  background: #fff;
  border-top: 1px solid #eee;
}

#estilos .style-group.active .style-panel {
  display: block;
  animation: fadeIn 0.25s ease;
}

/* ğŸ”¹ Botones internos */
#estilos .style-panel button {
  background: #f5f5f5;
  border-radius: 5px;
  padding: 6px 10px;
  border: 1px solid #ddd;
  color: #333;
  font-size: 0.85rem;
  margin: 3px;
  transition: all 0.2s ease;
}

#estilos .style-panel button:hover {
  background: var(--primary);
  color: #fff;
  border-color: var(--primary-dark);
}

/* === Ajuste dropdown de fuentes === */
.dropdown-font {
  position: relative;
  width: 100%;
}

.dropdown-content-font {
  display: none;
  position: absolute;
  top: 100%; /* directamente debajo del botÃ³n */
  left: 0;
  width: 100%;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.15);
  padding: 8px;
  z-index: 999;
  max-height: 300px;
  overflow-y: auto;
}

.dropdown-font.show .dropdown-content-font {
  display: block;
}

/* BotÃ³n de fuente */
.fontbtn {
  width: 100%;
  background: #1D3557;
  color: #fff;
  font-weight: 600;
  padding: 10px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.25s ease;
}
.fontbtn:hover {
  background: #27496d;
}

/* Tabs (categorÃ­as) */
.font-tabs {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.tab-btn {
  background: #457B9D;
  color: #fff;
  font-weight: 600;
  padding: 6px 8px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.2s ease;
}
.tab-btn.active {
  background: #1D3557;
}
.tab-btn::after {
  content: "â–¶";
  font-size: 0.8rem;
  transition: transform 0.3s ease;
}
.tab-btn.active::after {
  transform: rotate(90deg);
}

/* Fuentes dentro de cada categorÃ­a */
.font-tab-content {
  display: none;
  background: #fafafa;
  border-radius: 6px;
  padding: 6px 8px;
  border: 1px solid #ddd;
}
.font-tab-content.active {
  display: block;
}

.font-tab-content label {
  display: block;
  margin: 4px 0;
  padding: 4px 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.font-tab-content label:hover {
  background: #eef6fa;
  border-radius: 4px;
}

/* Flecha */
.font-tabs .tab-btn::after {
  content: "â–¶";
  font-size: 0.85rem;
  transition: transform 0.3s ease;
}
.font-tabs .tab-btn.active::after {
  transform: rotate(90deg);
}

/* === SUBLISTA DE FUENTES (justo debajo de cada tab-btn) === */
.font-tab-content {
  display: none;
  overflow: hidden;
  opacity: 0;
  transform: translateY(-4px);
  transition: all 0.3s ease;
  margin-left: 4px;
  border-left: 2px solid #d3e4f2;
  background: #fafafa;
  border-radius: 6px;
  padding: 0 8px;
}

/* ğŸ”¹ El bloque activo aparece inmediatamente debajo de su botÃ³n */
.font-tab-content.active {
  display: block;
  opacity: 1;
  transform: translateY(0);
  margin-top: 4px;
  padding: 6px 8px;
}

/* === CADA FUENTE === */
.font-tab-content label {
  display: block;
  padding: 6px 4px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.9rem;
}

.font-tab-content label:hover {
  background: #eef6fa;
  transform: translateX(4px);
  color: var(--primary-dark);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-3px); }
  to { opacity: 1; transform: translateY(0); }
}

/* === BOTONES PRINCIPALES (DiseÃ±os, Items, Columnas, Marcos, Firulete, Fondo) === */
.toggle-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  background: linear-gradient(90deg, #e9f2f9, #d9e8f4);
  color: #1D3557;
  padding: 10px 14px;
  margin: 0 0 8px 0;
  border: 1px solid #c9d8e3;
  border-radius: 8px;
  cursor: pointer;
  user-select: none;
  font-weight: 600;
  font-size: 0.95rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  transition: background 0.25s ease, transform 0.25s ease;
  position: relative;
}

.toggle-header:hover {
  background: linear-gradient(90deg, #d9e8f4, #cbe0ee);
  transform: scale(1.01);
}

/* Flechita animada */
.toggle-header::after {
  content: "â–¶";
  font-size: 0.9rem;
  color: #1D3557;
  transition: transform 0.3s ease;
  position: absolute;
  right: 12px;
}

.toggle-header.active::after {
  transform: rotate(90deg);
}

#formato {
  border-radius: 8px;
  padding: 1rem;
}
#formatoContenido {
  margin-top: 8px;
}
#btnFormato {
  width: 100%;
  background: #007bff;
  color: #fff;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  padding: 0.6rem;
  cursor: pointer;
}
#gridFormatos {
  margin-top: 0.8rem;
  display: grid;
  gap: 0.5rem;
}
#gridFormatos.oculto {
  display: none;
}
.grid-opciones {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 0.5rem;
}
.grid-opciones button {
  background: #0d6efd;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 0.6rem;
  font-size: 0.9rem;
  cursor: pointer;
}
.categorias-posicion {
  margin-top: 1rem;
  display: flex;
  justify-content: space-around;
}
.categorias-posicion label {
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

/* Contenedor del contenido desplegable */
.estilos-content {
  display: none;
  overflow: hidden;
  transition: all 0.3s ease;
  margin-top: 4px;
  margin-left: 20px;
}

.estilos-content.active {
  display: block;
  animation: fadeIn 0.25s ease;
}

/* === FORMATO === */
.btn-panel {
  width: 100%;
  background: #2b7fbf;
  color: white;
  border: none;
  padding: 0.6rem;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
}
.btn-panel:hover {
  background: #1f679a;
}

.format-grid {
  margin-top: 0.8rem;
  background: #f8f9fa;
  padding: 0.8rem;
  border-radius: 8px;
}
.format-grid.oculto {
  display: none;
}
.format-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 0.5rem;
}
.format-buttons button {
  background: #2b7fbf;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 0.5rem;
  cursor: pointer;
  transition: background 0.2s;
}
.format-buttons button:hover {
  background: #1f679a;
}

.categoria-options {
  display: flex;
  justify-content: space-around;
}
.categoria-options label {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  font-weight: 500;
}

#firuleteContenido .tab-btn {
  background:#457B9D; color:#fff; border:none; border-radius:6px;
  padding:8px 10px; display:flex; justify-content:space-between; align-items:center;
  transition:.2s; cursor:pointer;
}
#firuleteContenido .tab-btn::after { content:"â–¶"; transition:transform .3s }
#firuleteContenido .tab-btn.active { background:#1D3557; }
#firuleteContenido .tab-btn.active::after { transform:rotate(90deg); }

#firuleteContenido .font-tab-content { display:none; background:#f2f6fa; border:1px solid #dce6ef; border-radius:8px; padding:10px; }
#firuleteContenido .font-tab-content.active { display:block; }

#firuleteContenido .font-tab-content button {
  width:100%; border:none; border-radius:6px; padding:8px 10px; margin:6px 0;
  background:#376788; color:#fff; cursor:pointer; transition:filter .2s;
}
#firuleteContenido .font-tab-content button:hover { filter:brightness(1.08); }

#loading-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.95);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  font-family: "Sora", sans-serif;
  font-size: 1.2rem;
  z-index: 999999;
  transition: opacity 0.4s ease, visibility 0.4s ease;
}

#loading-overlay .loading-logo {
  width: 110px;
  height: 110px;
  margin-bottom: 12px;
  opacity: 0.9;
  animation: spin 2.5s linear infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 0.85; }
  50% { transform: scale(1.05); opacity: 1; }
}

#loading-overlay.hide {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}
  </style>
</head>

<body style="overflow:hidden;">

  <button id="toggleMenu"><i class="fas fa-gear"></i></button>

  <aside id="sideMenu">
    <h3>ğŸ¨ Editor MenuLab</h3>

    <section id="estilos">
      <h4 id="toggleEstilos" class="toggle-header">
        ğŸ’¡ DiseÃ±os Pre Configurados
      </h4>

      <div id="estilosContenido" class="estilos-content">
        <div class="style-group">
          <h5 class="style-header">ğŸ¥© Cocina Tradicional</h5>
          <div class="style-panel">
            <button data-preset="1">ğŸ”¥ Parrilla</button>
            <button data-preset="2">ğŸ· BodegÃ³n</button>
            <button data-preset="3">ğŸ½ï¸ Restaurante</button>
            <button data-preset="4">ğŸ¥˜ Comedor</button>
            <button data-preset="5">ğŸ³ RotiserÃ­a</button>
          </div>
        </div>

        <div class="style-group">
          <h5 class="style-header">â˜• CafÃ©s y Dulzuras</h5>
          <div class="style-panel">
            <button data-preset="6">ğŸ’ CafeterÃ­a</button>
            <button data-preset="7">ğŸ¥ PanaderÃ­a</button>
            <button data-preset="8">ğŸ§ PastelerÃ­a</button>
            <button data-preset="9">ğŸ« ChocolaterÃ­a</button>
            <button data-preset="10">ğŸµ Casa de tÃ©</button>
          </div>
        </div>

        <div class="style-group">
          <h5 class="style-header">ğŸº Bares y Nocturnos</h5>
          <div class="style-panel">
            <button data-preset="11">ğŸ“œ Bar</button>
            <button data-preset="12">ğŸ¸ CoctelerÃ­a</button>
            <button data-preset="13">ğŸµ Bar & MÃºsica</button>
            <button data-preset="14">ğŸ¹ After Office</button>
            <button data-preset="15">ğŸŒ™ Pub Nocturno</button>
          </div>
        </div>

        <div class="style-group">
          <h5 class="style-header">ğŸ” Fast Food / Take Away</h5>
          <div class="style-panel">
            <button data-preset="16">ğŸ• PizzerÃ­a</button>
            <button data-preset="17">ğŸ” HamburgueserÃ­a</button>
            <button data-preset="18">ğŸŒ® TaquerÃ­a</button>
            <button data-preset="19">ğŸ¥™ Shawarma</button>
            <button data-preset="20">ğŸ£ Sushi Bar</button>
          </div>
        </div>

        <div class="style-group">
          <h5 class="style-header">ğŸ¥— Saludables y Naturales</h5>
          <div class="style-panel">
            <button data-preset="21">ğŸ¥‘ Vegano</button>
            <button data-preset="22">ğŸ Healthy Food</button>
            <button data-preset="23">ğŸ Sin TACC</button>
            <button data-preset="24">ğŸ§˜â€â™‚ï¸ OrgÃ¡nico</button>
            <button data-preset="25">ğŸŒ¿ Natural Market</button>
          </div>
        </div>

        <div class="style-group">
          <h5 class="style-header">ğŸŒ Cocina Internacional</h5>
          <div class="style-panel">
            <button data-preset="26">ğŸ Trattoria Italiana</button>
            <button data-preset="27">ğŸ¥Ÿ AsiÃ¡tico</button>
            <button data-preset="28">ğŸŒ® Mexicano</button>
            <button data-preset="29">ğŸ¥˜ EspaÃ±ol</button>
            <button data-preset="30">ğŸ¥– FrancÃ©s</button>
          </div>
        </div>

        <div class="style-group">
          <h5 class="style-header">ğŸ¦ Postres y Especiales</h5>
          <div class="style-panel">
            <button data-preset="31">ğŸ° ReposterÃ­a</button>
            <button data-preset="32">ğŸ¦ HeladerÃ­a</button>
            <button data-preset="33">ğŸ¥§ Tartas</button>
            <button data-preset="34">ğŸ§‡ Waffles & Pancakes</button>
            <button data-preset="35">ğŸ‚ Cakeshop</button>
          </div>
        </div>

        <div class="style-group">
          <h5 class="style-header">ğŸšš Conceptos Modernos</h5>
          <div class="style-panel">
            <button data-preset="36">ğŸšš Food Truck</button>
            <button data-preset="37">ğŸŒ† Rooftop</button>
            <button data-preset="38">ğŸ–ï¸ Beach Bar</button>
            <button data-preset="39">ğŸ’¡ Idea Nueva</button>
            <button data-preset="40">âš™ï¸ Cocina de Autor</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ğŸ›ï¸ Items -->
    <section id="items">
      <h4 id="toggleItems" class="toggle-header">ğŸ›ï¸ Items</h4>
      <div id="itemsContenido" class="estilos-content">
        <div id="itemsList"></div>
      </div>
    </section>

    <!-- â¬› Columnas 
    <section id="columnas">
      <h4 id="toggleColumnas" class="toggle-header">â¬› Columnas</h4>
      <div id="columnasContenido" class="estilos-content">
        <button data-value="1">1 Columna</button>
        <button data-value="2">2 Columnas</button>
        <button data-value="3">3 Columnas</button>
      </div>
    </section>
    -->

    <!-- ğŸ§© Formato -->
    <section id="formato">
      <h4 id="toggleFormato" class="toggle-header">ğŸ§© Formato</h4>
      <div id="formatoContenido" class="estilos-content">
        <!-- 6 opciones -->
        <div class="format-buttons">
          <button data-layout="1">1ï¸âƒ£ Centrado</button>
          <button data-layout="2">2ï¸âƒ£ Doble Centrado</button>
          <button data-layout="3">3ï¸âƒ£ Doble Lateral</button>
          <button data-layout="4">4ï¸âƒ£ Triple Centrado</button>
          <button data-layout="5">5ï¸âƒ£ Triple Lateral</button>
        </div>

      </div>
    </section>

    <!-- ğŸ–¼ï¸ Marcos -->
    <section id="marcos">
      <h4 id="toggleMarcos" class="toggle-header">ğŸ–¼ï¸ Marcos</h4>
      <div id="marcosContenido" class="estilos-content">
        <label>Estilo de marco</label>
        <div>
          <button data-frame="none">Sin marco</button>
          <button data-frame="solid">LÃ­neal</button>
          <button data-frame="double">Paralelas</button>
          <button data-frame="dotted">Puntos</button>
          <button data-frame="dashed">Punteada</button>
          <button data-frame="groove">Relieve</button>
        </div>

        <label style="margin-top:10px;">Color del marco</label>
        <input type="color" id="frame-color" value="#000000">
        <label style="margin-top:10px;">Grosor</label>
        <input type="range" id="frame-width" min="1" max="15" step="1" value="2">
        <hr style="margin:10px 0;border:none;border-top:1px solid #ddd;">
        <label style="margin-top:10px;">ğŸ“¦ Marco por CategorÃ­a</label>
        <div>
          <button data-catframe="none">Sin marco</button>
          <button data-catframe="solid">LÃ­neal</button>
          <button data-catframe="double">Doble</button>
          <button data-catframe="dotted">Puntos</button>
          <button data-catframe="dashed">Punteada</button>
          <button data-catframe="groove">Relieve</button>
        </div>
        <label style="margin-top:10px;">Color del marco</label>
        <input type="color" id="cat-frame-color" value="#000000">
        <label style="margin-top:10px;">Grosor</label>
        <input type="range" id="cat-frame-width" min="1" max="15" step="1" value="2">
      </div>
    </section>

    <!-- ğŸ–¼ï¸ ImÃ¡genes -->
    <section id="imagenes">
    <h4 id="toggleImagenes" class="toggle-header">ğŸ–¼ï¸ ImÃ¡genes</h4>
    <div id="imagenesContenido" class="estilos-content">

        <!-- ğŸŒ„ Fondo -->
        <h5 style="margin-top:0;">ğŸŒ„ Fondo del menÃº</h5>
        <label>URL de la imagen de fondo</label>
        <input type="url" id="bg-url" placeholder="https://...">

        <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
        <label style="flex:1;">Opacidad</label>
        <input type="range" id="bg-opacity" min="0" max="1" step="0.01" value="0.2" style="flex:3;">
        <input type="number" id="bg-opacity-number" min="0" max="1" step="0.01" value="0.2" style="width:60px;">
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
        <label style="flex:1;">TamaÃ±o (%)</label>
        <input type="range" id="bg-size" min="50" max="200" step="1" value="100" style="flex:3;">
        <input type="number" id="bg-size-number" min="50" max="200" step="1" value="100" style="width:60px;">
        </div>

        <button id="saveBgBtn" style="margin-top:10px;width:100%;background:#457B9D;color:#fff;border:none;padding:8px;border-radius:6px;cursor:pointer;">ğŸ’¾ Guardar Fondo</button>

        <hr style="margin:16px 0;border:none;border-top:1px solid #ddd;">

        <!-- ğŸ·ï¸ Logo -->
        <h5>ğŸ·ï¸ Logo del restaurante</h5>
        <label>URL del logo</label>
        <input type="url" id="logo-url" placeholder="https://...">

        <div style="display:flex;align-items:center;margin-top:8px;">
            <label style="flex:1;">TamaÃ±o (%)</label>
            <input type="range" id="logo-size" min="0" max="200" step="1" value="100" style="flex:3;">
            <input type="number" id="logo-size-number" min="0" max="200" step="1" value="100" style="width:60px;">
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
            <label style="flex:1;">Opacidad</label>
            <input type="range" id="logo-opacity" min="0" max="1" step="0.01" value="1" style="flex:3;">
            <input type="number" id="logo-opacity-number" min="0" max="1" step="0.01" value="1" style="width:60px;">
        </div>
        <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
            <label style="flex:1;">Margen superior (px)</label>
            <input type="range" id="logo-margin-top" min="0" max="200" step="1" value="0" style="flex:3;">
            <input type="number" id="logo-margin-top-number" min="0" max="200" step="1" value="0" style="width:60px;">
        </div>
        <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
            <label style="flex:1;">Espacio Logo-Texto (px)</label>
            <input type="range" id="logo-gap" min="-20" max="100" step="1" value="10" style="flex:3;">
            <input type="number" id="logo-gap-number" min="-20" max="100" step="1" value="10" style="width:60px;">
        </div>

        <button id="saveLogoBtn" style="margin-top:10px;width:100%;background:#457B9D;color:#fff;border:none;padding:8px;border-radius:6px;cursor:pointer;">ğŸ’¾ Guardar Logo</button>
    </div>
    </section>

    <!-- ğŸ–¨ï¸ Vista previa -->
    <section id="previewControls">
      <button id="printBtn">ğŸ–¨ï¸ Vista Previa</button>
      <button id="printA3">ğŸ–¨ï¸ Imprimir A3</button>
      <button id="printA4">ğŸ–¨ï¸ Imprimir A4</button>
      <button id="printA5">ğŸ–¨ï¸ Imprimir A5</button>
    </section>
    <section id="saveControls">
      <button id="saveBtn">ğŸ’¾ Guardar</button>
    </section>

  </aside>

  <main id="previewArea">
    <iframe
      id="previewFrame"
      style="width:100%; height:100%; border:none;"
    ></iframe>
  </main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    /* === VERIFICAR SESIÃ“N === */
/*
(function(){
  try {
    const s = sessionStorage.getItem("ml_session");
    if (!s) return location.href = "login.html";
    const token = JSON.parse(s);
    if (!token.id || Date.now() > token.expires) {
      sessionStorage.removeItem("ml_session");
      location.href = "login.html";
    }
  } catch {
    location.href = "login.html";
  }
})();
*/
/* === VARIABLES GLOBALES === */
const preview = document.getElementById("previewFrame");
const menuBtn = document.getElementById("toggleMenu");
const sideMenu = document.getElementById("sideMenu");
const itemsList = document.getElementById("itemsList");
let previewReady = false;

const params = new URLSearchParams(window.location.search);
const tenant = params.get('tenant') || 'cafe_central';

/* === FUNCIÃ“N: enviar mensajes seguros al iframe (con cola) === */
const msgQueue = [];

function flushQueue(){
  while (previewReady && msgQueue.length){
    const {type, data} = msgQueue.shift();
    console.log("ğŸ“¤ [send] (flush) =>", type, data);
    preview.contentWindow.postMessage({ type, data }, "*");
  }
}

function sendToPreview(type, data) {
  if (!preview?.contentWindow) return;
  if (!previewReady) {
    console.warn("â³ [queue] preview no listo. Encolando:", type, data);
    msgQueue.push({type, data});
    return;
  }
  console.log("ğŸ“¤ [send] =>", type, data);
  preview.contentWindow.postMessage({ type, data }, "*");
}

/* === Esperar a que el iframe cargue === */
preview.addEventListener("load", () => {
  preview.contentWindow.postMessage({ type: "init", data: "editor-connected" }, "*");
});

/* === ITEMS (dinÃ¡micos) === */
const items = [
  { id: "nombre-resto", icon: "ğŸª", label: "Nombre GastronÃ³mico" },
  { id: "nombre-slogan", icon: "ğŸ–‹ï¸", label: "Eslogan" },
  { id: "categoria", icon: "ğŸ“‚", label: "CategorÃ­as" },
  { id: "subcategoria", icon: "ğŸ“", label: "SubcategorÃ­as" },
  { id: "plato", icon: "ğŸ½ï¸", label: "Nombre del Platos" },
  { id: "descripcion", icon: "ğŸ“", label: "Descripciones" },
  { id: "precio", icon: "ğŸ’²", label: "Precios" },
  { id: "info-resto", icon: "â„¹ï¸", label: "Info GastronÃ³mica" }
];

const fontOptions = `
  <option value="playfair">Playfair Display</option>
  <option value="montserrat">Montserrat</option>
  <option value="merriweather">Merriweather</option>
  <option value="oswald">Oswald</option>
  <option value="pacifico">Pacifico</option>
  <option value="quicksand">Quicksand</option>
  <option value="cormorant-garamond">Cormorant Garamond</option>
  <option value="amatic-sc">Amatic SC</option>
  <option value="tangerine">Tangerine</option>
  <option value="great-vibes">Great Vibes</option>
  <option value="dancing-script">Dancing Script</option>
  <option value="lobster">Lobster</option>
  <option value="cinzel">Cinzel</option>
  <option value="raleway">Raleway</option>
  <option value="poppins">Poppins</option>
  <option value="nunito">Nunito</option>
  <option value="lato">Lato</option>
  <option value="open-sans">Open Sans</option>
  <option value="roboto-slab">Roboto Slab</option>
  <option value="indie-flower">Indie Flower</option>
  <option value="satisfy">Satisfy</option>
  <option value="caveat">Caveat</option>
  <option value="abril-fatface">Abril Fatface</option>
  <option value="mali">Mali</option>
  <option value="uncial-antiqua">Uncial Antiqua</option>
`;

/* === Generar paneles de ITEMS === */
items.forEach(item => {
  const div = document.createElement("div");
  div.classList.add("item-config");
  div.dataset.item = item.id;
    // ğŸ’¡ Si es CategorÃ­as, incluimos el bloque de Firulete
  if (item.id === "categoria") {
    div.innerHTML = `
      <h5 class="item-header">${item.icon} ${item.label}</h5>
      <div class="item-panel">
        <!-- PosiciÃ³n categorÃ­as -->
        <div class="categoria-options">
          <label><input type="radio" name="posCategoria" value="izq"> Izquierda</label>
          <label><input type="radio" name="posCategoria" value="centro"> Centrada</label>
          <label><input type="radio" name="posCategoria" value="der"> Derecha</label>
        </div>
        
        <!-- ğŸ–‹ï¸ FUENTE -->
        <label style="margin-top:10px;">ğŸ–‹ï¸ Fuente</label>
        <div class="dropdown-font">
          <button class="fontbtn">ğŸ–‹ï¸ Elegir Fuente</button>
          <div class="dropdown-content-font">${fontOptions}</div>
        </div>

        <!-- ğŸ”  TAMAÃ‘O -->
        <label style="margin-top:10px;">ğŸ”  TamaÃ±o</label>
        <input type="range" min="0" max="4" step="0.01" class="size-range" value="1">

        <!-- ğŸ¨ COLOR -->
        <label style="margin-top:10px;">ğŸ¨ Color</label>
        <input type="color" class="color-input" value="#000000">

        <!-- ğŸ’  FIRULETE -->
        <label style="margin-top:6px;">âœ¨ Firulete</label>
        <div class="dropdown-font">
          <button class="fontbtn">âœ¨ Elegir Firulete</button>
          <div class="dropdown-content-font">
            <div class="font-tabs">
              <!-- âœ¨ BÃ¡sicos -->
              <button class="tab-btn" data-tab="basicos">âœ¨ BÃ¡sicos</button>
              <div class="font-tab-content" id="tab-basicos">
                <button data-value="">Ninguno</button>
                <button data-value="âœ¦ âœ¦ âœ¦">âœ¦ âœ¦ âœ¦ Brillos âœ¦ âœ¦ âœ¦</button>
                <button data-value="âœ¤ âœ¤ âœ¤">âœ¤ âœ¤ âœ¤ Sello âœ¤ âœ¤ âœ¤</button>
                <button data-value="â‹„ â‹„ â‹„">â‹„ â‹„ â‹„ Rombo â‹„ â‹„ â‹„</button>
                <button data-value="-------">-------- LÃ­nea --------</button>
                <button data-value="~~~~~">~~~~~ Ã‘uflo ~~~~~</button>
              </div>

              <!-- â¤ï¸ RomÃ¡nticos -->
              <button class="tab-btn" data-tab="romanticos">â¤ï¸ RomÃ¡nticos</button>
              <div class="font-tab-content" id="tab-romanticos">
                <button data-value="â¤ï¸ â™¡ â¤ï¸">â¤ï¸ â™¡ â¤ï¸ RomÃ¡ntico â¤ï¸ â™¡ â¤ï¸</button>
                <button data-value="ğŸ’ ğŸ’• ğŸ’">ğŸ’ ğŸ’• ğŸ’ Amor ğŸ’ ğŸ’• ğŸ’</button>
                <button data-value="ğŸ’– âœ¨ ğŸ’–">ğŸ’– âœ¨ ğŸ’– Brillante ğŸ’– âœ¨ ğŸ’–</button>
                <button data-value="â˜• ğŸ’ â˜•">â˜• ğŸ’ â˜• CafÃ© â˜• ğŸ’ â˜•</button>
              </div>

              <!-- ğŸŒ¿ Primaverales -->
              <button class="tab-btn" data-tab="naturales">ğŸŒ¿ Primaverales</button>
              <div class="font-tab-content" id="tab-naturales">
                <button data-value="ğŸƒ âœ¿ ğŸƒ">ğŸƒ âœ¿ ğŸƒ Natural ğŸƒ âœ¿ ğŸƒ</button>
                <button data-value="ğŸƒ ğŸŒ¸ ğŸƒ">ğŸƒ ğŸŒ¸ ğŸƒ Primavera ğŸƒ ğŸŒ¸ ğŸƒ</button>
                <button data-value="ğŸŒ¿ ğŸŒº ğŸŒ¿">ğŸŒ¿ ğŸŒº ğŸŒ¿ BotÃ¡nico ğŸŒ¿ ğŸŒº ğŸŒ¿</button>
                <button data-value="ğŸŒ» ğŸŒ¼ ğŸŒ»">ğŸŒ» ğŸŒ¼ ğŸŒ» Floral ğŸŒ» ğŸŒ¼ ğŸŒ»</button>
                <button data-value="ğŸ‚ ğŸ ğŸ‚">ğŸ‚ ğŸ ğŸ‚ OtoÃ±al ğŸ‚ ğŸ ğŸ‚</button>
              </div>

              <!-- â˜€ï¸ Eventos Patrios -->
              <button class="tab-btn" data-tab="patrios">â˜€ï¸ Eventos Patrios</button>
              <div class="font-tab-content" id="tab-patrios">
                <button data-value="â˜€ï¸ ğŸ§‰ â˜€ï¸">â˜€ï¸ ğŸ§‰ â˜€ï¸ DÃ­a de la Patria â˜€ï¸ ğŸ§‰ â˜€ï¸</button>
                <button data-value="ğŸ’™ ğŸ¤ ğŸ’™">ğŸ’™ ğŸ¤ ğŸ’™ 9 de Julio ğŸ’™ ğŸ¤ ğŸ’™</button>
                <button data-value="ğŸŒ ğŸ’ª ğŸ·">ğŸŒ ğŸ’ª ğŸ· Orgullo Nacional ğŸ· ğŸ’ª ğŸŒ</button>
                <button data-value="ğŸ¥Ÿ â˜• ğŸ§‰">ğŸ¥Ÿ â˜• ğŸ§‰ Tradicional ğŸ§‰ â˜• ğŸ¥Ÿ</button>
                <button data-value="ğŸ† ğŸ† ğŸ†">ğŸ† ğŸ† ğŸ† Mundial ğŸ† ğŸ† ğŸ†</button>
              </div>

              <!-- âš™ï¸ Modernos -->
              <button class="tab-btn" data-tab="modernos">âš™ï¸ Modernos</button>
              <div class="font-tab-content" id="tab-modernos">
                <button data-value="âš¡ âš¡ âš¡">âš¡ âš¡ âš¡ Rayo âš¡ âš¡ âš¡</button>
                <button data-value="âš¡ ğŸ”· âš¡">âš¡ ğŸ”· âš¡ ElÃ©ctrico âš¡ ğŸ”· âš¡</button>
                <button data-value="ğŸ’  ğŸ”¹ ğŸ’ ">ğŸ’  ğŸ”¹ ğŸ’  Digital ğŸ’  ğŸ”¹ ğŸ’ </button>
                <button data-value="ğŸ’ âœ¦ ğŸ’">ğŸ’ âœ¦ ğŸ’ Futurista ğŸ’ âœ¦ ğŸ’</button>
                <button data-value="ğŸ”º ğŸ”¸ ğŸ”º">ğŸ”º ğŸ”¸ ğŸ”º Minimal ğŸ”º ğŸ”¸ ğŸ”º</button>
              </div>

              <!-- ğŸ· Bebidas -->
              <button class="tab-btn" data-tab="elegante">ğŸ· Bebidas</button>
              <div class="font-tab-content" id="tab-elegante">
                <button data-value="ğŸ¸ ğŸ‹ ğŸ¸">ğŸ¸ ğŸ‹ ğŸ¸ Signature ğŸ¸ ğŸ‹ ğŸ¸</button>
                <button data-value="ğŸ¥‚ âœ¨ ğŸ¥‚">ğŸ¥‚ âœ¨ ğŸ¥‚ Brindis ğŸ¥‚ âœ¨ ğŸ¥‚</button>
                <button data-value="ğŸ· ğŸ’ ğŸ·">ğŸ· ğŸ’ ğŸ· Reserva ğŸ· ğŸ’ ğŸ·</button>
                <button data-value="ğŸ¹ ğŸŒ´ ğŸ¹">ğŸ¹ ğŸŒ´ ğŸ¹ Tropical ğŸ¹ ğŸŒ´ ğŸ¹</button>
                <button data-value="ğŸ¾ ğŸ’« ğŸ¾">ğŸ¾ ğŸ’« ğŸ¾ Premium ğŸ¾ ğŸ’« ğŸ¾</button>
              </div>

              <!-- ğŸ”¥ RÃºsticos -->
              <button class="tab-btn" data-tab="rustico">ğŸ”¥ RÃºsticos</button>
              <div class="font-tab-content" id="tab-rustico">
                <button data-value="ğŸ”¥ ğŸ– ğŸ”¥">ğŸ”¥ ğŸ– ğŸ”¥ Asador ğŸ”¥ ğŸ– ğŸ”¥</button>
                <button data-value="ğŸ¥© ğŸ· ğŸ¥©">ğŸ¥© ğŸ· ğŸ¥© Grill ğŸ¥© ğŸ· ğŸ¥©</button>
                <button data-value="ğŸº ğŸ– ğŸº">ğŸº ğŸ– ğŸº Cervecero ğŸº ğŸ– ğŸº</button>
                <button data-value="ğŸ· ğŸ•¯ï¸ ğŸ·">ğŸ· ğŸ•¯ï¸ ğŸ· Bodega ğŸ· ğŸ•¯ï¸ ğŸ·</button>
              </div>

              <!-- ğŸŒˆ Creativos -->
              <button class="tab-btn" data-tab="creativos">ğŸŒˆ Creativos</button>
              <div class="font-tab-content" id="tab-creativos">
                <button data-value="ğŸŒˆ ğŸ’« ğŸŒˆ">ğŸŒˆ ğŸ’« ğŸŒˆ ArcoÃ­ris ğŸŒˆ ğŸ’« ğŸŒˆ</button>
                <button data-value="ğŸ¨ ğŸ–Œï¸ ğŸ¨">ğŸ¨ ğŸ–Œï¸ ğŸ¨ ArtÃ­stico ğŸ¨ ğŸ–Œï¸ ğŸ¨</button>
                <button data-value="â­ ğŸŒ™ â­">â­ ğŸŒ™ â­ Nocturno â­ ğŸŒ™ â­</button>
                <button data-value="ğŸµ ğŸ’« ğŸµ">ğŸµ ğŸ’« ğŸµ Musical ğŸµ ğŸ’« ğŸµ</button>
              </div>

              <!-- ğŸ‰ Eventos Especiales -->
              <button class="tab-btn" data-tab="eventos">ğŸ‰ Eventos Especiales</button>
              <div class="font-tab-content" id="tab-eventos">
                <button data-value="ğŸƒ ğŸ•¯ï¸ ğŸ’€">ğŸƒ ğŸ•¯ï¸ ğŸ’€ Halloween ğŸ’€ ğŸ•¯ï¸ ğŸƒ</button>
                <button data-value="ğŸ„ â„ï¸ ğŸ">ğŸ„ â„ï¸ ğŸ Navidad ğŸ â„ï¸ ğŸ„</button>
                <button data-value="ğŸ• âœ¨ ğŸ•¯ï¸">ğŸ• âœ¨ ğŸ•¯ï¸ Hanukkah ğŸ•¯ï¸ âœ¨ ğŸ•</button>
                <button data-value="ğŸ† ğŸ‡ ğŸ†">ğŸ† ğŸ‡ ğŸ† AÃ±o Nuevo ğŸ† ğŸ‡ ğŸ†</button>
                <button data-value="ğŸ’ â¤ï¸ ğŸŒ¸">ğŸ’ â¤ï¸ ğŸŒ¸ San ValentÃ­n ğŸŒ¸ â¤ï¸ ğŸ’</button>
              </div>
            </div>
          </div>
        </div>

        <label style="margin-top:8px;">ğŸŒ«ï¸ Opacidad Firulete</label>
        <input type="range" min="0" max="1" step="0.01" class="firulete-opacity-range" value="0.4">
      </div>`;
  } 
  // ğŸ”¹ Todos los demÃ¡s Ã­tems se mantienen igual
  else {
  div.innerHTML = `
    <h5 class="item-header">${item.icon} ${item.label}</h5>
    <div class="item-panel">
      <label>ğŸ–‹ï¸ Fuente</label>
        <div class="dropdown-font">
          <button class="fontbtn">ğŸ–‹ï¸ Elegir Fuente</button>
          <div class="dropdown-content-font">
            <!-- Contenedor principal -->
            <div class="font-tabs">
              <button class="tab-btn" data-tab="elegantes">ğŸ’ Elegantes</button>
              <div class="font-tab-content" id="tab-elegantes">
                <label data-value="Tangerine" style="font-family:'Tangerine', cursive;">ğŸ© De Autor</label>
                <label data-value="Cormorant Garamond" style="font-family:'Cormorant Garamond', serif;">ğŸ· ClÃ¡sico</label>
                <label data-value="Playfair Display" style="font-family:'Playfair Display', serif;">â˜• Gourmet</label>
                <label data-value="Merriweather" style="font-family:'Merriweather', serif;">ğŸ¥ Patisserie</label>
                <label data-value="Quicksand" style="font-family:'Quicksand', sans-serif;">ğŸŒ¹ Elegante</label>
              </div>

              <button class="tab-btn" data-tab="rusticos">ğŸ”¥ RÃºsticos</button>
              <div class="font-tab-content" id="tab-rusticos">
                <label data-value="Almendra Display" style="font-family:'Almendra Display', serif;">ğŸ”¥ Parrilla</label>
                <label data-value="Milonga" style="font-family:'Milonga', serif;">ğŸ· BodegÃ³n</label>
                <label data-value="Vast Shadow" style="font-family:'Vast Shadow', serif;">ğŸ¥© Grill House</label>
                <label data-value="Anton" style="font-family:'Anton', sans-serif;">ğŸ– Tradicional</label>
                <label data-value="Rubik Wet Paint" style="font-family:'Rubik Wet Paint', system-ui;">ğŸª¶ Hecho a Mano</label>
              </div>

              <button class="tab-btn" data-tab="modernas">âš™ï¸ Modernas</button>
              <div class="font-tab-content" id="tab-modernas">
                <label data-value="Montserrat" style="font-family:'Montserrat', sans-serif;">ğŸ™ï¸ Moderna</label>
                <label data-value="Codystar" style="font-family:'Codystar', sans-serif;">ğŸ’¡ Minimal</label>
                <label data-value="Source Code Pro" style="font-family:'Source Code Pro', monospace;">âŒ¨ï¸ TÃ©cnica</label>
                <label data-value="Monoton" style="font-family:'Monoton', sans-serif;">ğŸ’« Neon</label>
                <label data-value="Oswald" style="font-family:'Oswald', sans-serif;">ğŸ“ Arquitecta</label>
              </div>

              <button class="tab-btn" data-tab="experimentales">âš¡ Experimentales</button>
              <div class="font-tab-content" id="tab-experimentales">
                <label data-value="Coral Pixels" style="font-family:'Coral Pixels', serif;">ğŸ§© Pixelada</label>
                <label data-value="Ranchers" style="font-family:'Ranchers', sans-serif;">ğŸ  Retro Pop</label>
                <label data-value="Major Mono Display" style="font-family:'Major Mono Display', monospace;">ğŸ”  TipogrÃ¡fica</label>
                <label data-value="Chokokutai" style="font-family:'Chokokutai', system-ui;">ğŸœ Oriental</label>
                <label data-value="Ewert" style="font-family:'Ewert', serif;">ğŸ›ï¸ Grabado</label>
              </div>

              <button class="tab-btn" data-tab="distendidos">ğŸŒ¿ Distendidos</button>
              <div class="font-tab-content" id="tab-distendidos">
                <label data-value="Caveat" style="font-family:'Caveat', cursive;">âœï¸ Animada</label>
                <label data-value="Indie Flower" style="font-family:'Indie Flower', cursive;">ğŸ’¬ Amigable</label>
                <label data-value="Amatic SC" style="font-family:'Amatic SC', cursive;">ğŸ¨ ArtÃ­stica</label>
                <label data-value="Sora" style="font-family:'Sora', sans-serif;">ğŸŒˆ Chill</label>
                <label data-value="Pacifico" style="font-family:'Pacifico', cursive;">ğŸ–ï¸ Artesanal</label>
              </div>
            </div>
          </div>
        </div>


      <label style="margin-top:10px;">ğŸ”¤ TamaÃ±o</label>
      <input type="range" min="0" max="4" step="0.01" class="size-range" value="1">

      <label style="margin-top:10px;">ğŸ¨ Color</label>
      <input type="color" class="color-input" value="#000000">
    </div>`;
  }
  itemsList.appendChild(div);
});


/* === Listeners para cada item === */
function attachListeners() {
  document.querySelectorAll(".item-config").forEach(block => {
    const section = block.dataset.item;
    const sizeInput = block.querySelector(".size-range");
    const colorInput = block.querySelector(".color-input");

    // TamaÃ±o
    sizeInput?.addEventListener("input", () => {
      sendToPreview("size-section", { section, value: sizeInput.value });
    });

    // Color
    colorInput?.addEventListener("input", () => {
      sendToPreview("color-section", { section, value: colorInput.value });
    });

    // Dropdowns de fuentes
    const dropdown = block.querySelector(".dropdown-font");
    const btn = dropdown.querySelector(".fontbtn");
    const content = dropdown.querySelector(".dropdown-content-font");

    // Abrir / cerrar menÃº principal
    btn.addEventListener("click", e => {
      e.stopPropagation();
      document.querySelectorAll(".dropdown-font.show").forEach(o => {
        if (o !== dropdown) o.classList.remove("show");
      });
      dropdown.classList.toggle("show");
    });

    // Cerrar si se hace clic fuera
    window.addEventListener("click", e => {
      if (!dropdown.contains(e.target)) dropdown.classList.remove("show");
    });

    // Tabs (categorÃ­as de fuentes)
    const tabs = content.querySelectorAll(".tab-btn");
    tabs.forEach(tab => {
      tab.addEventListener("click", e => {
        e.stopPropagation();
        const targetId = `tab-${tab.dataset.tab}`;
        const panel = content.querySelector(`#${targetId}`);

        const isActive = tab.classList.contains("active");

        // Primero cerramos todo
        tabs.forEach(t => t.classList.remove("active"));
        content.querySelectorAll(".font-tab-content").forEach(p => p.classList.remove("active"));

        // Si la pestaÃ±a estaba cerrada, la abrimos
        if (!isActive) {
          tab.classList.add("active");
          panel?.classList.add("active");
        }
      });
    });

    // SelecciÃ³n de fuente
    content.querySelectorAll("label[data-value]").forEach(label => {
      label.addEventListener("click", e => {
        e.stopPropagation();
        const fontValue = label.dataset.value;
        btn.textContent = `ğŸ–‹ï¸ ${label.textContent}`;
        sendToPreview("font-section", { section, font: fontValue });
        dropdown.classList.remove("show");
      });
    });
  });
}
attachListeners();

// === FIRULETE DENTRO DE CATEGORÃAS ===
document.querySelectorAll(".item-config[data-item='categoria'] .font-tab-content button[data-value]").forEach(btn => {
  btn.addEventListener("click", () => {
    const val = btn.dataset.value || "";
    sendToPreview("firulete", val);
  });
});

document.querySelectorAll(".item-config[data-item='categoria'] .firulete-opacity-range").forEach(range => {
  range.addEventListener("input", e => {
    const val = e.target.value;
    sendToPreview("firulete-opacity", val);
  });
});


/* === Desplegables de ITEMS (Nombre, Eslogan, etc.) === */
document.querySelectorAll(".item-header").forEach(header => {
  header.addEventListener("click", e => {
    e.stopPropagation();
    const item = header.closest(".item-config");
    item.classList.toggle("active");
  });
});

/* === CARGAR MENÃš EN IFRAME (usar URL directa para mantener origen) === */
(function loadPreview() {
  // intenta localizar el iframe (adapta id si tu iframe tiene otro)
  const preview = document.querySelector('iframe#preview, iframe#previewFrame, iframe#previewArea, iframe');
  if (!preview) { console.error('iframe preview no encontrado'); return; }


  // URL directa (cache-buster)
  const url = `./menu.html?tenant=${encodeURIComponent(tenant)}&_=${Date.now()}`;

  // cargar como documento normal (preserva mismo origen y permite fetch dentro)
  preview.src = url;

  // opcional: escuchar load para enviar init al iframe
  preview.addEventListener('load', () => {
    try { preview.contentWindow.postMessage({ type: 'init', data: 'editor-connected' }, '*'); } catch(e) { /* noop */ }
    console.log('âœ… Preview cargado:', url);
  });

  // si querÃ©s refrescar manualmente desde el editor:
  window.reloadPreview = () => {
    preview.src = `./menu.html?tenant=${encodeURIComponent(tenant)}&_=${Date.now()}`;
  };
})();

/* === Presets === */
document.querySelectorAll("#estilos .style-header").forEach(header => {
  header.addEventListener("click", () => {
    header.parentElement.classList.toggle("active");
  });
});


/* === COLUMNAS === */
document.querySelectorAll("#columnasContenido button[data-value]").forEach(btn => {
  btn.addEventListener("click", () => {
    sendToPreview("columns", parseInt(btn.dataset.value));
  });
});

/* === FORMATO === */
document.querySelectorAll("#formatoContenido button[data-format]").forEach(btn => {
  btn.addEventListener("click", () => {
    const format = btn.dataset.format;
    sendToPreview("formato", format);
  });
});

/* === IMÃGENES (Fondo y Logo) === */
(function(){
  const tenant = new URLSearchParams(window.location.search).get('tenant') || 'cafe_central';
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyswfpcLHgKj1zAvHgGCpYs6EWLqwfqjEM-mxFErwp_g8jTPr8qi-5tVGfNyXzqGgYG/exec";

  // === Referencias a elementos ===
  const bgUrl = document.getElementById("bg-url");
  const bgOpacity = document.getElementById("bg-opacity");
  const bgOpacityNum = document.getElementById("bg-opacity-number");
  const bgSize = document.getElementById("bg-size");
  const bgSizeNum = document.getElementById("bg-size-number");
  const saveBgBtn = document.getElementById("saveBgBtn");

  const logoUrl = document.getElementById("logo-url");
  const logoSize = document.getElementById("logo-size");
  const logoSizeNum = document.getElementById("logo-size-number");
  const logoOpacity = document.getElementById("logo-opacity");
  const logoOpacityNum = document.getElementById("logo-opacity-number");
  const saveLogoBtn = document.getElementById("saveLogoBtn");
  const logoMarginTop = document.getElementById("logo-margin-top");
  const logoMarginTopNum = document.getElementById("logo-margin-top-number");

  // === SincronizaciÃ³n sliders <-> nÃºmeros ===
  function linkRange(num, range, key){
    num.addEventListener("input", ()=>{
      range.value = num.value;
      sendToPreview(key, num.value);
    });
    range.addEventListener("input", ()=>{
      num.value = range.value;
      sendToPreview(key, range.value);
    });
  }

  linkRange(bgOpacityNum, bgOpacity, "opacity");
  linkRange(bgSizeNum, bgSize, "bg-size");
  linkRange(logoOpacityNum, logoOpacity, "logo-opacity");
  linkRange(logoSizeNum, logoSize, "logo-size");
  linkRange(logoMarginTopNum, logoMarginTop, "logo-margin-top");
  linkRange(document.getElementById("logo-gap-number"), document.getElementById("logo-gap"), "logo-gap");

  // === Guardar fondo ===
  saveBgBtn?.addEventListener("click", async ()=>{
    const url = bgUrl.value.trim();
    if (!url) return alert("IngresÃ¡ una URL para el fondo.");
    sendToPreview("bg-url", url);

    const params = new URLSearchParams({
      action: "save_image",
      tenant,
      cell: "M3", // celda de fondo
      value: url
    });
    await fetch(`${SCRIPT_URL}?${params}`);
    alert("âœ… Fondo guardado en la planilla.");
  });

  // === Guardar logo ===
  saveLogoBtn?.addEventListener("click", async ()=>{
    const url = logoUrl.value.trim();
    if (!url) return alert("IngresÃ¡ una URL para el logo.");
    sendToPreview("logo-url", url);

    const params = new URLSearchParams({
      action: "save_image",
      tenant,
      cell: "L3", // celda de logo
      value: url
    });
    await fetch(`${SCRIPT_URL}?${params}`);
    alert("âœ… Logo guardado en la planilla.");
  });
})();


/* === MARCOS === */
document.querySelectorAll("#marcosContenido button[data-frame]").forEach(btn => {
  btn.addEventListener("click", () => {
    sendToPreview("frame-style", btn.dataset.frame);
  });
});
// === MARCOS POR CATEGORÃA ===
document.querySelectorAll("#marcosContenido button[data-catframe]").forEach(btn => {
  btn.addEventListener("click", () => {
    sendToPreview("cat-frame-style", btn.dataset.catframe);
  });
});
// === Color marco por categorÃ­a ===
const catFrameColor = document.getElementById("cat-frame-color");
if (catFrameColor) {
  catFrameColor.addEventListener("input", e => {
    sendToPreview("cat-frame-color", e.target.value);
  });
}

// === Grosor marco por categorÃ­a ===
const catFrameWidth = document.getElementById("cat-frame-width");
if (catFrameWidth) {
  catFrameWidth.addEventListener("input", e => {
    sendToPreview("cat-frame-width", e.target.value);
  });
}

const frameColor = document.getElementById("frame-color");
if (frameColor) {
  frameColor.addEventListener("input", e => {
    sendToPreview("frame-color", e.target.value);
  });
}
const frameWidth = document.getElementById("frame-width");
if (frameWidth) {
  frameWidth.addEventListener("input", e => {
    sendToPreview("frame-width", e.target.value);
  });
}

/* === Vista Previa / Imprimir === */
const printBtn = document.getElementById("printBtn");
if (printBtn) {
  printBtn.addEventListener("click", () => {
    if (preview && preview.contentWindow) {
      preview.contentWindow.print();
    }
  });
}

/* === NUEVOS BOTONES DE IMPRESIÃ“N ESCALADA === */

function setPrintMode(mode) {
  const doc = preview.contentDocument.body;
  doc.classList.remove("print-A3", "print-A4", "print-A5");
  doc.classList.add(mode);
  preview.contentWindow.print();
}

// Si querÃ©s botÃ³n para imprimir A4
document.getElementById("printA4")?.addEventListener("click", () => {
  setPrintMode("print-A4");
});

// Si querÃ©s botÃ³n para imprimir A3
document.getElementById("printA3")?.addEventListener("click", () => {
  setPrintMode("print-A3");
});

// Si querÃ©s botÃ³n para imprimir A5
document.getElementById("printA5")?.addEventListener("click", () => {
  setPrintMode("print-A5");
});

/* === MenÃº mobile === */
menuBtn.addEventListener("click", () => {
  sideMenu.classList.toggle("open");
});

/* === GUARDAR FORMATO EN GOOGLE SHEETS === */
const saveBtn = document.getElementById("saveBtn");
let nombreFormato = "";

saveBtn.addEventListener("click", async () => {
  if (!previewReady) {
    alert("EsperÃ¡ a que el menÃº estÃ© listo para guardar el formato.");
    return;
  }

  nombreFormato = prompt("IngresÃ¡ un nombre para este formato de menÃº:");
  if (!nombreFormato) return;

  // Pedimos al iframe su estado actual
  preview.contentWindow.postMessage({ type: "get-current-styles" }, "*");
});

/* === Listener unificado para mensajes del iframe === */
window.addEventListener("message", async (e) => {
  const { type, data } = e.data || {};
  if (!type) return;

  // âœ… Permitir todo si viene del mismo host o sin origen (GitHub Pages a veces deja origin vacÃ­o)
  const host = location.origin;
  const from = e.origin || "unknown";

  const allowed = [
    "https://www.menulab.com.ar",
    "https://menulab.com.ar",
    "http://localhost:5173",
    "http://127.0.0.1:5173",
    "http://127.0.0.1:5500",
    "file://",
    host, // ğŸ‘ˆ permite mismo dominio aunque GitHub Pages use sin www
    "",
    "null",
    "unknown"
  ];

  if (!allowed.includes(from)) {
    console.warn("âš ï¸ Mensaje recibido desde origen no reconocido:", from, "(permitido por fallback universal)");
  }
    function sanitize(obj) {
    try {
        // ğŸ’¡ Elimina funciones, DOM y referencias circulares
        return JSON.parse(JSON.stringify(obj));
    } catch (err) {
        console.warn("âš ï¸ Error sanitizando data:", err);
        return {};
    }
    }

  switch (type) {
    case "ready":
    case "init": // aceptar init como sinÃ³nimo de ready (handshake)
      previewReady = true;
      console.log("âœ… MenÃº conectado, listo para recibir cambios (ready/init)");
      // dar un pequeÃ±o delay para evitar race conditions con iframes remotos
      setTimeout(() => flushQueue?.(), 10);
      break;
case "current-styles-response":
  try {
    const API_URL = "https://script.google.com/macros/s/AKfycbyswfpcLHgKj1zAvHgGCpYs6EWLqwfqjEM-mxFErwp_g8jTPr8qi-5tVGfNyXzqGgYG/exec";

    // Copia segura del objeto
    const safeData = JSON.parse(JSON.stringify(data));

    // ğŸ§© Agregar cantidad de columnas activas
    const cols = getComputedStyle(document.documentElement)
                  .getPropertyValue("--menu-columns")
                  ?.trim() || "1";
    safeData.columns = parseInt(cols, 10) || 1;

    // âš™ï¸ Importante â†’ serializar antes de meter en URLSearchParams
    const dataStr = JSON.stringify(safeData);

    const qs = new URLSearchParams({
      action: "save_style",
      tenant: tenant,
      data: dataStr,
      _: Date.now().toString()
    });

    console.log("ğŸ’¾ Guardando estilo limpio (con columnas):", safeData);

    const response = await fetch(`${API_URL}?${qs.toString()}`, { method: "GET" });
    const text = await response.text();

    let result;
    try {
      result = JSON.parse(text);
    } catch {
      result = { raw: text };
    }

    if (result && result.success) {
      alert("âœ… Formato guardado con Ã©xito");
      console.log("ğŸ“¦ Respuesta Apps Script:", result);
    } else {
      alert("âš ï¸ Error al guardar formato");
      console.warn("âŒ Respuesta Apps Script:", result);
    }
  } catch (err) {
    console.error("Error al guardar:", err);
    alert("âŒ Error al conectar con Apps Script");
  }
  break;

  }
});


/* === Presets (aplicar) === */
document.querySelectorAll('#estilosContenido button[data-preset]').forEach(btn => {
  btn.addEventListener('click', () => {
    const id = parseInt(btn.dataset.preset, 10);
    if (!isNaN(id)) {
      console.log("ğŸ¨ Aplicando preset", id);
      // applyPreset vive en presets.js y usa sendToPreview internamente
      applyPreset(id);
    }
  });
});

/* === DESPLEGABLES PRINCIPALES (DiseÃ±os, Items, Columnas, etc.) === */
(function() {
  const headers = document.querySelectorAll(".toggle-header");
  headers.forEach(header => {
    header.addEventListener("click", e => {
      e.stopPropagation();
      header.classList.toggle("active");
      const content = header.nextElementSibling;
      if (content) content.classList.toggle("active");
    });
  });
})();

// === FORMATO (abre directamente desde el header) ===
document.addEventListener("DOMContentLoaded", () => {
  const formatoBotones = document.querySelectorAll(".format-buttons button");
  const radios = document.querySelectorAll("input[name='posCategoria']");

  // Cada layout aplica formato y lo envÃ­a al iframe
  formatoBotones.forEach(btn => {
    btn.addEventListener("click", e => {
      const layout = e.target.dataset.layout;
      console.log("ğŸ“ Aplicando formato:", layout);
      sendToPreview("formato-layout", layout);
    });
  });

  // Radios de posiciÃ³n de categorÃ­as
  radios.forEach(radio => {
    radio.addEventListener("change", e => {
      const pos = e.target.value;
      console.log("ğŸ“‘ PosiciÃ³n de categorÃ­as:", pos);
      sendToPreview("categoria-pos", pos);
    });
  });
});

  // Ocultar overlay cuando termina de cargar el menÃº
  window.addEventListener("load", () => {
    const overlay = document.getElementById("loading-overlay");
    setTimeout(() => {
      //overlay.classList.add("hide");
      document.body.style.overflow = "auto"; // âœ… vuelve a mostrar el resto
    }, 700);
  });

  document.querySelectorAll("#marcosContenido button[data-frame]").forEach(btn => {
    btn.addEventListener("click", () => {
        const frame = btn.dataset.frame;
        localStorage.setItem("pdf-frame-style", frame); // ğŸ‘ˆ guardamos para el PDF
        sendToPreview("frame-style", frame);
    });
  });

/* === DESCARGAR PDF (menÃº visual) === */
const downloadBtn = document.getElementById("downloadBtn");
const menu = document.getElementById("downloadMenu");

downloadBtn.addEventListener("click", () => {
  menu.style.display = menu.style.display === "none" ? "block" : "none";
});

document.addEventListener("click", (e) => {
  if (!menu.contains(e.target) && e.target !== downloadBtn) {
    menu.style.display = "none";
  }
});
  </script>
  <script src="presets.js"></script>


  </body>
</html>